<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Shubhzone</title>

    <!-- ======== Firebase SDK CDN Scripts ======== -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-analytics-compat.js"></script>

    <style>
        /* --- Global Styles & Theme --- */
        :root {
            --dark-bg: #121212;
            --primary-text: #ffffff;
            --secondary-text: #b3b3b3;
            --card-bg: #1e1e1e;
            --accent-gradient: linear-gradient(90deg, #ff416c, #ff4b2b);
            --transparent-black: rgba(0, 0, 0, 0.7);
            --placeholder-bg: #2a2a2a;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif; background-color: var(--dark-bg); color: var(--primary-text); overflow-x: hidden; -webkit-overflow-scrolling: touch; }
        .page { padding: 20px 15px 80px 15px; display: none; min-height: calc(100vh - 65px); overflow-y: auto; -webkit-overflow-scrolling: touch; }
        .page.active { display: block; }
        h2 { color: var(--primary-text); margin-bottom: 15px; }
        .button, .submit-button { width: 100%; padding: 15px; border: none; border-radius: 10px; background: var(--accent-gradient); color: white; font-size: 18px; font-weight: bold; cursor: pointer; text-align: center; box-shadow: 0 4px 10px rgba(255, 75, 43, 0.4); transition: background 0.3s, opacity 0.3s; }
        .button:disabled, .submit-button:disabled { opacity: 0.6; cursor: not-allowed; background: #555; }

        /* --- Video Grid --- */
        .video-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .video-card { background-color: var(--card-bg); border-radius: 10px; overflow: hidden; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); position: relative; cursor: pointer; }
        .video-thumbnail-placeholder { width: 100%; aspect-ratio: 16 / 9; background-color: var(--placeholder-bg); display: flex; justify-content: center; align-items: center; }
        .video-thumbnail-placeholder img, .video-thumbnail-placeholder video { width: 100%; height: 100%; object-fit: cover; }
        .video-thumbnail-placeholder svg { width: 30%; height: 30%; max-width: 48px; fill: var(--secondary-text); opacity: 0.5; }
        .video-card-info { padding: 8px; }
        .video-card-info p { font-size: 14px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        /* --- Bottom Navigation --- */
        .bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; background-color: var(--transparent-black); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); display: flex; justify-content: space-around; padding: 10px 0; border-top: 1px solid rgba(255, 255, 255, 0.1); z-index: 100; }
        .nav-item { display: flex; flex-direction: column; align-items: center; color: var(--secondary-text); cursor: pointer; transition: color 0.3s; }
        .nav-item.active { color: var(--primary-text); }
        .nav-item.active .nav-icon { background: var(--accent-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .nav-item.upload-plus { position: relative; top: -15px; }
        .nav-icon { width: 28px; height: 28px; }
        .nav-icon.upload-icon { width: 50px; height: 50px; background: var(--accent-gradient); color: white; border-radius: 50%; display: flex; justify-content: center; align-items: center; box-shadow: 0 0 15px rgba(255, 75, 43, 0.5); }
        .nav-label { font-size: 10px; margin-top: 2px; }

        /* --- Form & Upload Page Styles --- */
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; color: var(--secondary-text); margin-bottom: 8px; font-size: 14px; }
        .form-group input[type="text"], .form-group textarea { width: 100%; background-color: var(--card-bg); border: 1px solid #444; border-radius: 8px; padding: 12px; color: var(--primary-text); font-size: 16px; }
        .form-group textarea { resize: vertical; min-height: 80px; }
        .radio-group label { margin-right: 15px; }
        .radio-group input[type="radio"] { margin-right: 5px; }
        .upload-container { display: flex; gap: 15px; margin-bottom: 20px; }
        .file-uploader-card { flex: 1; border: 2px dashed #444; border-radius: 10px; display: flex; justify-content: center; align-items: center; flex-direction: column; color: var(--secondary-text); cursor: pointer; background-color: var(--placeholder-bg); aspect-ratio: 16 / 9; overflow: hidden; position: relative; }
        .file-uploader-card .upload-text { text-align: center; }
        .file-uploader-card svg { margin-bottom: 10px; fill: var(--secondary-text); width: 30%; max-width: 48px; }
        .file-uploader-card .preview-video, .file-uploader-card .preview-image { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; display: none; }
        .progress-bar-container { width: 100%; background-color: var(--card-bg); border-radius: 10px; overflow: hidden; height: 10px; margin-top: 20px; display: none; }
        .progress-bar { width: 0%; height: 100%; background: var(--accent-gradient); transition: width 0.4s ease; }

        /* ======== PROFESSIONAL VIDEO PLAYER STYLES (ENHANCED) ======== */
        #videoPlayerOverlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: #000; z-index: 200; display: none; flex-direction: column; justify-content: center; align-items: center; }
        #videoPlayerOverlay video { width: 100%; max-height: 100%; }
        .player-container { position: relative; width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; }
        
        /* Player Controls */
        .player-controls-wrapper { position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; transition: opacity 0.3s ease; }
        .player-controls-wrapper.visible { opacity: 1; }
        .top-controls { position: absolute; top: 0; left: 0; right: 0; padding: 15px; display: flex; align-items: center; background: linear-gradient(to bottom, rgba(0,0,0,0.6), transparent); }
        .close-player-btn { background: none; border: none; color: white; cursor: pointer; }
        .close-player-btn svg { width: 24px; height: 24px; }
        .video-title-player { color: white; font-weight: bold; margin-left: 15px; font-size: 16px; }
        .bottom-controls { position: absolute; bottom: 0; left: 0; right: 0; padding: 10px 15px; background: linear-gradient(to top, rgba(0,0,0,0.7), transparent); }
        .seek-bar-container { width: 100%; margin-bottom: 5px; }
        #seekBar { -webkit-appearance: none; width: 100%; height: 4px; background: rgba(255, 255, 255, 0.4); border-radius: 2px; outline: none; cursor: pointer; transition: height 0.2s; }
        #seekBar:hover { height: 6px; }
        #seekBar::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 14px; height: 14px; background: var(--primary-text); border-radius: 50%; cursor: pointer; }
        .main-controls { display: flex; justify-content: space-between; align-items: center; }
        .main-controls button { background: none; border: none; color: white; cursor: pointer; padding: 5px; }
        .main-controls button svg { width: 28px; height: 28px; }
        .time-container { color: white; font-size: 12px; font-family: 'Courier New', Courier, monospace; }
        
        /* Gestures and Loading */
        .gesture-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; }
        .gesture-zone { flex: 1; height: 100%; }
        .loading-spinner { border: 4px solid rgba(255, 255, 255, 0.3); border-radius: 50%; border-top: 4px solid #fff; width: 50px; height: 50px; animation: spin 1s linear infinite; position: absolute; display: none; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* ======== PROFILE/DASHBOARD PAGES (RESTORED) ======== */
        #infoSubmissionPage .info-button { background: var(--accent-gradient); color: white; padding: 8px 15px; border-radius: 20px; font-size: 14px; cursor: pointer; font-weight: bold; display: inline-block; margin-bottom: 20px; }
        #infoSubmissionPage .file-upload-button { background-color: var(--card-bg); border: 1px solid #444; border-radius: 8px; padding: 12px; text-align: center; cursor: pointer; }
        #infoSubmissionPage .submit-button { margin-top: 30px; }
        #userDashboardPage { padding: 0 0 80px 0; }
        .dashboard-header { display: flex; align-items: center; gap: 15px; padding: 15px; background-color: var(--card-bg); border-bottom: 1px solid #333; }
        .dashboard-header .profile-pic { width: 60px; height: 60px; border-radius: 50%; object-fit: cover; background-color: var(--placeholder-bg); }
    </style>
</head>
<body>

    <!-- ======== MAIN CONTENT AREA ======== -->
    <div id="homePage" class="page active">
        <div class="video-grid" id="homeVideoGrid"></div>
        <p id="video-status-message" style="color: var(--secondary-text); text-align: center; margin: 20px; display: none;"></p>
    </div>

    <!-- ======== UPLOAD PAGE (FIELDS RESTORED) ======== -->
    <div id="uploadPage" class="page">
        <h2>Upload Video</h2>
        <div class="form-group"><label for="videoTitle">Video Title</label><input type="text" id="videoTitle" placeholder="Enter a catchy title"></div>
        <div class="form-group"><label for="description">Description</label><textarea id="description" placeholder="Tell viewers about your video"></textarea></div>
        <!-- RESTORED FIELDS -->
        <div class="form-group"><label for="tags">Tags (comma separated)</label><input type="text" id="tags" placeholder="e.g., tech, comedy, music"></div>
        <div class="form-group"><label>Age Restriction</label><div class="radio-group"><input type="radio" id="ageAll" name="age" value="all" checked> <label for="ageAll">All Audiences</label><input type="radio" id="age18" name="age" value="18+"> <label for="age18">18+</label></div></div>
        
        <div class="upload-container">
            <div class="file-uploader-card" onclick="document.getElementById('videoFileInput').click()"><!-- ... SVG and text ... --> <video class="preview-video" muted></video></div>
            <div class="file-uploader-card" onclick="document.getElementById('thumbnailInput').click()"><!-- ... SVG and text ... --> <img class="preview-image" alt="Thumbnail Preview"/></div>
        </div>
        <input type="file" id="videoFileInput" style="display: none;" accept="video/*">
        <input type="file" id="thumbnailInput" style="display: none;" accept="image/*">
        
        <div id="uploadSubmitButton" class="button upload-button" onclick="uploadVideo()">✅ Upload Video</div>
        <div class="progress-bar-container"><div class="progress-bar" id="progressBar"></div></div>
    </div>
    
    <!-- ======== PROFILE PAGES (RESTORED) ======== -->
    <div id="infoSubmissionPage" class="page">
        <h2>Submit Your Information</h2>
        <p style="color: var(--secondary-text); margin-top: -10px; margin-bottom: 25px;">Your details will be verified. After approval, your profile will be activated.</p>
        <div class="form-group"><label for="fullName">Full Name</label><input type="text" id="fullName" placeholder="आपका पूरा नाम"></div>
        <div class="form-group"><label for="email">Email Address</label><input type="email" id="email" placeholder="आपका ईमेल पता"></div>
        <div class="submit-button" onclick="submitForApproval()">Submit for Approval</div>
    </div>

    <div id="userDashboardPage" class="page">
        <header class="dashboard-header">
            <img class="profile-pic" src="https://picsum.photos/seed/user_approved/120/120" alt="User Profile Picture">
            <!-- ... other dashboard content ... -->
        </header>
        <h2>My Dashboard</h2>
        <p>Your content will be displayed here.</p>
    </div>
    
    <!-- ======== BOTTOM NAVIGATION BAR ======== -->
    <nav class="bottom-nav">
        <div id="navHome" class="nav-item active" onclick="showPage('homePage')"><svg class="nav-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M11.47 3.84a.75.75 0 0 1 1.06 0l8.25 8.25a.75.75 0 0 1-1.06 1.06l-8.25-8.25a.75.75 0 0 1 0-1.06Z"/><path d="m12 5.432 8.25 8.25-1.06 1.06-8.25-8.25 1.06-1.06Zm-2.632 2.632L12 5.432l1.06 1.06-2.632 2.632-1.06-1.06Z"/><path d="M3 14.25a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75a.75.75 0 0 1-.75-.75Z"/></svg><span class="nav-label">Home</span></div>
        <div class="nav-item upload-plus" onclick="showPage('uploadPage')"><div class="nav-icon upload-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 16 16"><path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/></svg></div></div>
        <div id="navProfile" class="nav-item" onclick="handleProfileClick()"><svg class="nav-icon" viewBox="0 0 24 24" fill="currentColor"><path fill-rule="evenodd" d="M18.685 19.097A9.723 9.723 0 0 0 21.75 12c0-5.385-4.365-9.75-9.75-9.75S2.25 6.615 2.25 12a9.723 9.723 0 0 0 3.065 7.097A9.716 9.716 0 0 0 12 21.75a9.716 9.716 0 0 0 6.685-2.653ZM5.855 16.52a7.486 7.486 0 0 1 5.855-2.812c1.585 0 3.065.392 4.392 1.07a6.241 6.241 0 0 0-10.247 0ZM15.75 9a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z" clip-rule="evenodd" /></svg><span class="nav-label">Profile</span></div>
    </nav>
    
    <!-- ======== PROFESSIONAL VIDEO PLAYER OVERLAY (ENHANCED) ======== -->
    <div id="videoPlayerOverlay">
        <div class="player-container">
            <div class="loading-spinner" id="loadingSpinner"></div>
            <video id="mainVideoPlayer" playsinline></video>
            
            <div class="gesture-overlay">
                <div class="gesture-zone" id="gesture-rewind"></div>
                <div class="gesture-zone" id="gesture-play-pause"></div>
                <div class="gesture-zone" id="gesture-forward"></div>
            </div>

            <div class="player-controls-wrapper" id="controlsWrapper">
                <div class="top-controls">
                    <button class="close-player-btn" onclick="closePlayer()">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M7.72 12.53a.75.75 0 0 1 0-1.06l7.5-7.5a.75.75 0 1 1 1.06 1.06L9.31 12l6.97 6.97a.75.75 0 1 1-1.06 1.06l-7.5-7.5Z"/></svg>
                    </button>
                    <span id="videoTitlePlayer" class="video-title-player"></span>
                </div>
                <div class="bottom-controls">
                    <div class="seek-bar-container">
                        <input type="range" id="seekBar" value="0" step="0.1">
                    </div>
                    <div class="main-controls">
                        <button id="playPauseBtn">
                            <svg id="playIcon" viewBox="0 0 24 24"><path fill="currentColor" d="M8,5.14V19.14L19,12.14L8,5.14Z" /></svg>
                            <svg id="pauseIcon" style="display:none;" viewBox="0 0 24 24"><path fill="currentColor" d="M14,19H18V5H14M6,19H10V5H6V19Z" /></svg>
                        </button>
                        <div class="time-container"><span id="currentTime">00:00</span> / <span id="totalDuration">00:00</span></div>
                        <button id="fullscreenBtn">
                            <svg viewBox="0 0 24 24"><path fill="currentColor" d="M5,5H10V7H7V10H5V5M14,5H19V10H17V7H14V5M17,14H19V19H14V17H17V14M7,17H10V19H5V14H7V17Z" /></svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let isUserApproved = false; // Start with user not approved
        const pages = document.querySelectorAll('.page');
        const navItems = document.querySelectorAll('.nav-item');

        function showPage(pageId) {
            pages.forEach(page => page.classList.remove('active'));
            document.getElementById(pageId)?.classList.add('active');
            // Update nav active state...
        }

        async function populateHomeContent() {
            // ... same as before ...
        }
        
        // ======== PROFESSIONAL VIDEO PLAYER LOGIC (ENHANCED) ========
        const playerOverlay = document.getElementById('videoPlayerOverlay');
        const playerContainer = document.querySelector('.player-container');
        const videoElement = document.getElementById('mainVideoPlayer');
        const loadingSpinner = document.getElementById('loadingSpinner');
        const controlsWrapper = document.getElementById('controlsWrapper');
        const playPauseBtn = document.getElementById('playPauseBtn');
        const playIcon = document.getElementById('playIcon');
        const pauseIcon = document.getElementById('pauseIcon');
        const seekBar = document.getElementById('seekBar');
        const currentTimeEl = document.getElementById('currentTime');
        const totalDurationEl = document.getElementById('totalDuration');
        const fullscreenBtn = document.getElementById('fullscreenBtn');
        const videoTitlePlayer = document.getElementById('videoTitlePlayer');
        let controlsTimeout;

        async function playVideo(videoKey, title) { // Pass title here
            if (!videoKey) { return; }
            playerOverlay.style.display = 'flex';
            loadingSpinner.style.display = 'block';
            videoElement.style.display = 'none';
            videoTitlePlayer.textContent = title || 'Loading...';

            try {
                const response = await fetch(`/api/videos/${videoKey}/play`);
                const data = await response.json();
                if (data.success) {
                    videoElement.src = data.url;
                } else { throw new Error('Could not get video link'); }
            } catch (error) { closePlayer(); alert('Error playing video.'); }
        }
        
        function closePlayer() {
            playerOverlay.style.display = 'none';
            videoElement.pause();
            videoElement.src = "";
            if (document.fullscreenElement) document.exitFullscreen();
        }

        function togglePlayPause() {
            videoElement.paused ? videoElement.play() : videoElement.pause();
        }

        function formatTime(time) {
            const minutes = Math.floor(time / 60);
            const seconds = Math.floor(time % 60);
            return `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
        }

        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                playerContainer.requestFullscreen().catch(err => alert(`Fullscreen failed: ${err.message}`));
            } else {
                document.exitFullscreen();
            }
        }
        
        function showControls() {
            controlsWrapper.classList.add('visible');
            clearTimeout(controlsTimeout);
            controlsTimeout = setTimeout(() => {
                if (!videoElement.paused) controlsWrapper.classList.remove('visible');
            }, 3000);
        }

        // Player event listeners
        videoElement.addEventListener('canplay', () => {
            loadingSpinner.style.display = 'none';
            videoElement.style.display = 'block';
            videoElement.play();
        });
        videoElement.addEventListener('loadedmetadata', () => {
            totalDurationEl.textContent = formatTime(videoElement.duration);
            seekBar.max = videoElement.duration;
        });
        videoElement.addEventListener('play', () => { playIcon.style.display = 'none'; pauseIcon.style.display = 'block'; showControls(); });
        videoElement.addEventListener('pause', () => { playIcon.style.display = 'block'; pauseIcon.style.display = 'none'; showControls(); });
        videoElement.addEventListener('timeupdate', () => {
            currentTimeEl.textContent = formatTime(videoElement.currentTime);
            seekBar.value = videoElement.currentTime;
        });
        
        seekBar.addEventListener('input', () => videoElement.currentTime = seekBar.value);
        playPauseBtn.addEventListener('click', togglePlayPause);
        fullscreenBtn.addEventListener('click', toggleFullscreen);
        playerContainer.addEventListener('mousemove', showControls);
        
        // Gesture Handling
        let tapTimer;
        document.getElementById('gesture-rewind').addEventListener('click', handleTap);
        document.getElementById('gesture-play-pause').addEventListener('click', handleTap);
        document.getElementById('gesture-forward').addEventListener('click', handleTap);

        function handleTap(e) {
            clearTimeout(tapTimer);
            if (e.detail === 1) { // Single tap
                tapTimer = setTimeout(() => {
                    togglePlayPause();
                    showControls();
                }, 250);
            } else if (e.detail === 2) { // Double tap
                const rect = e.target.getBoundingClientRect();
                const x = e.clientX - rect.left;
                if (e.target.id.includes('rewind')) {
                    videoElement.currentTime -= 10;
                } else if (e.target.id.includes('forward')) {
                    videoElement.currentTime += 10;
                }
            }
        }

        // --- Profile Page Logic (RESTORED & FIXED) ---
        function handleProfileClick() {
            showPage(isUserApproved ? 'userDashboardPage' : 'infoSubmissionPage');
            // Make sure the nav item is active
            document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
            document.getElementById('navProfile').classList.add('active');
        }

        function submitForApproval() {
            alert('Information submitted! You will be redirected after approval.');
            // In a real app, you would not set this here. This is for demo.
            isUserApproved = true; 
            handleProfileClick();
        }

        // --- Upload page logic (file preview)
        document.getElementById('videoFileInput').addEventListener('change', function() { /* ... */ });
        document.getElementById('thumbnailInput').addEventListener('change', function() { /* ... */ });
        function uploadVideo() { /* ... */ }

        // --- Initial Page Load ---
        document.addEventListener('DOMContentLoaded', () => {
            // populateHomeContent(); // You would call this here
            showPage('homePage');
        });

        // Demo content for home page
        document.getElementById('homeVideoGrid').innerHTML = `
            <div class="video-card" onclick="playVideo('key1', 'Awesome Nature Video')"><div class="video-thumbnail-placeholder"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="currentColor" d="M8,5.14V19.14L19,12.14L8,5.14Z" /></svg></div><div class="video-card-info"><p>Awesome Nature Video</p></div></div>
            <div class="video-card" onclick="playVideo('key2', 'City Timelapse')"><div class="video-thumbnail-placeholder"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="currentColor" d="M8,5.14V19.14L19,12.14L8,5.14Z" /></svg></div><div class="video-card-info"><p>City Timelapse</p></div></div>
        `;

    </script>
</body>
</html>
