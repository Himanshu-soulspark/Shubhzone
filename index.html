<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Raksha Sutra</title>
    <style>
        /* --- Google Fonts --- */
        @import url('https://fonts.googleapis.com/css2?family=Tiro+Devanagari+Hindi:wght@400&family=Poppins:wght@400;600;700&display=swap');

        /* --- CSS Variables --- */
        :root {
            --primary-color: #e94d6e;
            --secondary-color: #f06595;
            --text-color: #34495e;
            --light-text-color: #f0f0f0;
            --card-bg: rgba(255, 255, 255, 0.4);
            --blur-effect: blur(10px);
        }

        /* --- General Styles --- */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { height: 100%; }

        body {
            font-family: 'Poppins', sans-serif;
            background: url('Leonardo_Phoenix_10_A_beautiful_festive_background_for_a_Raks_3.jpg') no-repeat center center/cover;
            overflow: hidden;
            color: var(--text-color);
        }
        
        /* --- Page Container --- */
        .page {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            transition: opacity 0.7s ease-in-out, transform 0.7s ease-in-out;
            opacity: 0;
            transform: scale(0.95);
            pointer-events: none;
            padding: 20px;
            text-align: center;
            overflow-y: auto;
        }

        .page.active {
            opacity: 1;
            transform: scale(1);
            pointer-events: auto;
        }

        /* --- Landing Page --- */
        .title {
            font-family: 'Tiro Devanagari Hindi', serif;
            font-size: clamp(2.8rem, 8vw, 4.5rem);
            color: #fff;
            text-shadow: 3px 3px 10px rgba(0, 0, 0, 0.5);
            margin-bottom: 20px;
        }

        .video-card {
            position: relative;
            width: 90vw;
            max-width: 600px;
            aspect-ratio: 16 / 9;
            background: var(--card-bg);
            backdrop-filter: var(--blur-effect);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }

        .video-card video { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; }
        .subtitle { margin-top: 25px; font-size: clamp(0.9rem, 2.5vw, 1.1rem); color: var(--light-text-color); max-width: 600px; text-shadow: 2px 2px 6px rgba(0, 0, 0, 0.5); padding: 0 15px; }

        .cta-button {
            padding: 15px 40px;
            font-size: 1.1rem;
            font-weight: 600;
            color: #fff;
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            border: none;
            border-radius: 50px;
            cursor: pointer;
            text-decoration: none;
            box-shadow: 0 10px 25px rgba(233, 77, 110, 0.4);
            transition: all 0.3s ease;
            margin-top: 20px;
        }
        .cta-button:hover { transform: translateY(-5px); box-shadow: 0 15px 30px rgba(233, 77, 110, 0.5); }
        .cta-button:disabled { background: #ccc; cursor: not-allowed; }

        /* --- Speaker Icon --- */
        #speaker-icon { position: fixed; top: 20px; right: 20px; font-size: 1.8rem; color: white; cursor: pointer; z-index: 1000; text-shadow: 2px 2px 5px rgba(0,0,0,0.4); }

        /* --- Form & Profile Page --- */
        .form-container { width: 90%; max-width: 450px; padding: 40px 30px; background: var(--card-bg); backdrop-filter: var(--blur-effect); border: 1px solid rgba(255, 255, 255, 0.4); border-radius: 20px; box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2); }
        .form-container h2 { font-family: 'Poppins', serif; font-size: 2rem; color: var(--text-color); margin-bottom: 30px; }
        .input-group { margin-bottom: 20px; position: relative;}
        .input-field { width: 100%; padding: 15px; border: 1px solid rgba(0,0,0,0.1); border-radius: 10px; background-color: rgba(255,255,255,0.7); font-size: 1rem; color: var(--text-color); }
        .back-link { display: inline-block; margin-top: 15px; color: var(--text-color); text-decoration: none; font-weight: 600; }
        
        /* --- Home Page --- */
        #home-page { justify-content: space-between; padding: 80px 20px 20px 20px; }
        .home-header { position: absolute; top: 0; left: 0; width: 100%; padding: 20px; background: rgba(0,0,0,0.2); backdrop-filter: blur(5px); z-index: 10; }
        .home-header .title { margin: 0; font-size: 2rem; text-align: center; }
        #home-page .content-area { display: flex; flex-direction: column; align-items: center; width: 100%; gap: 25px; max-width: 500px; flex-grow: 1; justify-content: center; }
        .cards-container { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; width: 100%; }
        .home-card-wrapper { display: flex; flex-direction: column; align-items: center; gap: 15px; }
        .home-card { width: 100%; aspect-ratio: 1 / 1; background-size: cover; background-position: center; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); cursor: pointer; transition: transform 0.3s ease; }
        .home-card:hover { transform: scale(1.05); }
        #home-page .cta-button { margin-top: 0; width: 100%; padding: 12px 20px; font-size: 1rem; }
        .home-footer { width: 100%; max-width: 500px; display: flex; flex-direction: column; gap: 15px; margin-top: auto; padding-top:20px; }
        .footer-strip { width: 100%; padding: 15px 25px; font-size: 1.1rem; font-weight: 600; color: #fff; background: rgba(0, 0, 0, 0.3); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 15px; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; gap: 10px; }
        
        /* --- Profile Page --- */
        #profile-page .profile-info { text-align: left; width: 100%; }
        #profile-page .profile-info p { margin-bottom: 20px; color: var(--text-color); font-weight: 600; }
        #profile-page .profile-info span { font-weight: 400; word-break: break-all; background: rgba(0,0,0,0.2); padding: 5px 8px; border-radius: 8px; color: white; text-shadow: 1px 1px 2px rgba(0,0,0,0.4); }

        /* --- UPDATED: Main Interface Page --- */
        #main-interface-page { overflow: hidden; }
        #main-interface-page .page-content { display: flex; flex-direction: column; align-items: center; justify-content: center; width: 100%; height: 100%; padding: 20px; gap: 30px; }
        .interface-layout { display: flex; flex-direction: row; align-items: stretch; justify-content: center; gap: 20px; width: 100%; height: 70vh; max-height: 500px; z-index: 1; }
        
        .main-content-card {
            width: 45%;
            max-width: 280px;
            aspect-ratio: 9 / 16;
            border-radius: 20px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.4);
            position: relative;
            flex-shrink: 0;
            border: 2px solid rgba(255,255,255,0.5);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        #main-interface-video-card video { width: 100%; height: 100%; object-fit: cover; }
        .date-display { position: absolute; top: 15px; left: 50%; transform: translateX(-50%); color: #fff; background: rgba(233, 77, 110, 0.7); padding: 5px 15px; border-radius: 12px; font-size: clamp(0.7rem, 2vw, 0.9rem); font-weight: 600; text-shadow: 1px 1px 2px rgba(0,0,0,0.2); z-index: 5; white-space: nowrap; }
        
        #main-interface-message-card {
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(15px);
            padding: 20px;
            opacity: 0;
            transform: translateX(50px);
            animation: revealCard 1.5s 0.5s ease-out forwards;
        }

        #main-interface-message { 
            color: white; 
            text-shadow: 1px 1px 4px rgba(0,0,0,0.7); 
            font-size: clamp(0.75rem, 1.8vw, 0.9rem); 
            line-height: 1.6; 
            white-space: pre-wrap; 
            text-align: left; 
            overflow-y: auto; 
            flex-grow: 1;
        }
        
        #replay-speech-btn { font-size: 1.6rem; cursor: pointer; color: white; background: rgba(0,0,0,0.2); border-radius: 50%; padding: 8px; position: absolute; bottom: 15px; right: 15px; transition: transform 0.2s; z-index: 10;}
        #replay-speech-btn:hover { transform: scale(1.1); }
        
        #mystery-box-btn { font-size: 3rem; padding: 15px; width: auto; border:none; background: none; cursor: pointer; transition: all 0.3s ease; filter: drop-shadow(0 5px 15px rgba(0,0,0,0.4)); }
        #mystery-box-btn:hover { transform: translateY(-5px) scale(1.1); filter: drop-shadow(0 10px 20px rgba(0,0,0,0.5));}

        @keyframes revealCard { to { opacity: 1; transform: translateX(0); } }
        
        @media (max-width: 600px) {
            .interface-layout { height: 65vh; max-height: 450px; }
            .main-content-card { width: 48%; }
            #main-interface-message { font-size: 0.7rem; }
        }

        /* --- Falling Flowers Animation --- */
        #falling-elements-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; overflow: hidden; z-index: 2; pointer-events: none; }
        .falling-element { position: absolute; top: -50px; animation: fall linear infinite; font-size: 1.5rem; }
        @keyframes fall { to { transform: translateY(105vh) rotate(360deg); } }
        
        /* --- Final Greeting Display Page --- */
        #final-greeting-display-page .form-container { transform: scale(0); animation: pop-in 0.5s forwards; }
        #final-greeting-message { min-height: 250px; padding: 25px; background: rgba(255,255,255,0.8); border-radius: 15px; font-size: 1.2rem; line-height: 1.7; color: var(--text-color); display: flex; align-items: center; justify-content: center; text-align: center; white-space: pre-wrap; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        @keyframes pop-in { to { transform: scale(1); } }
    </style>
</head>
<body>

<audio id="background-audio" loop><source src="3.m4a" type="audio/mp4"></audio>
<div id="speaker-icon">🔇</div>

<!-- Page 1: Landing Page -->
<div id="landing-page" class="page active">
    <h1 class="title">Raksha Sutra</h1>
    <div class="video-card"><video autoplay loop muted playsinline><source src="Generated File August 07, 2025 - 7_34PM.mp4" type="video/mp4"></video></div>
    <p class="subtitle">"रक्षाबंधन सिर्फ एक धागा नहीं, बल्कि दिलों का एक अटूट बंधन है।<br>आइए इस रिश्ते को फिर से महसूस करें, एक प्यार भरी डिजिटल राखी के साथ।"</p>
    <button id="get-started-btn" class="cta-button">शुरू करें</button>
</div>

<!-- Page 2: Info Form Page -->
<div id="form-page" class="page">
    <div class="form-container">
        <h2>अपनी जानकारी भरें</h2>
        <form id="info-form">
            <div class="input-group"><input type="text" id="name" class="input-field" placeholder="पूरा नाम" required></div>
            <div class="input-group"><input type="tel" id="phone" class="input-field" placeholder="मोबाइल नंबर (यह आपकी पहचान होगी)" required></div>
            <div class="input-group"><textarea id="address" rows="3" class="input-field" placeholder="पूरा पता" required></textarea></div>
            <button type="submit" class="cta-button">सबमिट करें</button>
        </form>
    </div>
</div>

<!-- Page 3: Main Interface Page -->
<div id="main-interface-page" class="page">
    <div id="falling-elements-container"></div>
    <div class="page-content">
        <div class="interface-layout">
            <div id="main-interface-video-card" class="main-content-card">
                 <div class="date-display">शनिवार, 9 अगस्त, 2025</div>
                <video playsinline id="main-video-player"></video>
            </div>
            <div id="main-interface-message-card" class="main-content-card">
                <div id="main-interface-message"></div>
                <div id="replay-speech-btn">🔊</div>
            </div>
        </div>
        <button id="mystery-box-btn">🎁</button>
    </div>
</div>

<!-- Page 4: Home Page -->
<div id="home-page" class="page">
    <header class="home-header"><h1 class="title">रक्षा सूत्र</h1></header>
    <div class="content-area">
        <div class="cards-container">
            <div class="home-card-wrapper">
                <div id="message-card-btn" class="home-card" style="background-image: url('IMG-20250807-WA0000.jpg');"></div>
                <button id="open-message-creator-btn" class="cta-button">संदेश भेजें</button>
            </div>
            <div class="home-card-wrapper">
                <div id="card-creator-btn" class="home-card" style="background-image: url('Leonardo_Phoenix_10_A_beautifully_designed_Raksha_Bandhan_Mass_1.jpg');"></div>
                <button id="open-card-creator-btn" class="cta-button">कार्ड बनाएं</button>
            </div>
        </div>
    </div>
    <div class="home-footer">
        <div id="my-profile-strip" class="footer-strip">मेरी प्रोफाइल</div>
        <div id="change-music-strip" class="footer-strip">संगीत बदलें</div>
        <div id="whatsapp-share-strip" class="footer-strip">
            <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="#FFFFFF"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M.05 22c.12-.59.25-1.18.41-1.76l.09-.32c.31-1.09.7-2.14 1.18-3.15.53-1.12 1.16-2.19 1.88-3.18.82-1.1 1.74-2.1 2.76-3 .2-.18.4-.36.6-.53l.4-.33c.53-.44 1.1-.82 1.7-1.14.99-.53 2.03-.9 3.1-1.1.33-.07.67-.12 1.01-.16.29-.03.59-.05.88-.05.23 0 .46.01.69.03.37.03.74.08 1.1.15.99.19 1.94.55 2.83 1.06.88.5 1.69 1.14 2.41 1.89s1.25 1.53 1.75 2.41c.45.83.78 1.71 1 2.62.22.91.31 1.85.28 2.79-.03.95-.2 1.89-.51 2.79-.31.9-.76 1.76-1.33 2.55-.57.79-1.25 1.5-2.02 2.11-.78.6-1.63 1.1-2.54 1.49-.91.38-1.88.64-2.86.76-.98.12-1.97.1-2.95-.05-.98-.15-1.95-.44-2.88-.86a12.926 12.926 0 01-2.7-1.48c-.24-.13-.47-.27-.7-.41l-1.68-1.02c-.55-.33-1.1-.68-1.64-1.05-.1-.07-.2-.14-.3-.21l-.06-.05c-.62-.48-1.2-1-1.73-1.57-.49-.52-.93-1.08-1.32-1.68-.3-.46-.55-.95-.77-1.45l-.02-.06c-.25-.56-.47-1.14-.65-1.73l-.04-.13c-.22-.72-.39-1.46-.5-2.22-.05-.33-.08-.67-.1-1H.05zM9.3 8.35c.14-.38.33-.74.58-1.06.25-.32.55-.6.88-.82.34-.22.7-.4 1.08-.52s.78-.18 1.18-.18c.39 0 .78.04 1.15.13.37.09.73.23 1.06.41.33.18.64.41.91.68.27.27.5.58.68.91.18.33.31.69.4 1.06.09.37.13.76.13 1.15s-.04.78-.13 1.15c-.09.37-.22.73-.4 1.06-.18.33-.41.64-.68.91-.27.27-.58.5-.91.68-.33.18-.69.32-1.06.41-.37-.09-.76.13-1.15.13s-.78-.04-1.15-.13c-.37-.09-.73-.23-1.06-.41-.33-.18-.64-.41-.91-.68-.27-.27-.5-.58-.68-.91-.18-.33-.31-.69-.4-1.06-.09-.37-.13-.76-.13-1.15s.05-.78.14-1.15z"/></svg>
            <span>व्हाट्सएप पर शेयर करें</span>
        </div>
        <div id="view-shared-strip" class="footer-strip">प्राप्त संदेश देखें</div>
    </div>
</div>

<!-- Page 5: My Profile Page -->
<div id="profile-page" class="page">
    <div class="form-container">
        <h2>मेरी प्रोफाइल</h2>
        <div class="profile-info">
            <p>आपका नाम:</p>
            <div class="input-group"><input type="text" id="profile-name-input" class="input-field" placeholder="आपका नाम" required></div>
            
            <p>आपका पता:</p>
            <div class="input-group"><textarea id="profile-address-input" class="input-field" placeholder="आपका पता" rows="3" required></textarea></div>

            <p>आपकी आईडी: <span id="profile-call-id">रजिस्टर्ड नहीं है</span></p>
        </div>
        <button id="update-profile-btn" class="cta-button">प्रोफाइल अपडेट करें</button>
        <a href="#" class="back-link" data-target="home-page">वापस जाएं</a>
    </div>
</div>


<!-- Page 6: Music Change Page -->
<div id="music-page" class="page">
     <div class="form-container">
        <h2>संगीत बदलें</h2>
        <button class="cta-button music-btn" data-src="1.m4a">रक्षा सूत्र संगीत 1</button>
        <button class="cta-button music-btn" data-src="2.m4a">रक्षा सूत्र संगीत 2</button>
        <button class="cta-button music-btn" data-src="3.m4a">रक्षा सूत्र संगीत 3</button>
        <a href="#" class="back-link" data-target="home-page">वापस जाएं</a>
    </div>
</div>

<!-- Page 7: Pre-made Message Creator Page -->
<div id="message-creator-page" class="page">
    <div class="form-container">
        <h2 id="message-creator-title">एक संदेश बनाएं</h2>
        <button id="bhai-to-bhen-btn" class="cta-button" style="width:100%; margin-bottom: 15px;">भाई की तरफ से बहन के लिए</button>
        <button id="bhen-to-bhai-btn" class="cta-button" style="width:100%;">बहन की तरफ से भाई के लिए</button>
         <a href="#" class="back-link" data-target="home-page">वापस जाएं</a>
    </div>
</div>

<!-- Page 8: Name Input for Messages -->
<div id="message-name-form-page" class="page">
    <div class="form-container">
        <h2 id="message-name-title">नाम दर्ज करें</h2>
        <form id="message-name-form">
            <div class="input-group"><input type="text" id="sender-name" class="input-field" placeholder="आपका नाम" required></div>
            <div class="input-group"><input type="text" id="receiver-name" class="input-field" placeholder="भाई/बहन का नाम" required></div>
            <button type="submit" class="cta-button">संदेश देखें</button>
        </form>
        <a href="#" class="back-link" data-target="message-creator-page">वापस जाएं</a>
    </div>
</div>

<!-- Page 9: Message Display Page -->
<div id="message-display-page" class="page">
     <div class="form-container">
        <h2>आपके लिए एक प्यारा संदेश</h2>
        <div id="message-display-card" style="width: 100%; min-height: 250px; padding: 25px; background: rgba(255,255,255,0.7); border-radius: 15px; font-size: 1.1rem; line-height: 1.6; color: var(--text-color); display: flex; align-items: center; justify-content: center; text-align: center; margin-bottom: 20px; white-space: pre-wrap; overflow-y: auto;"></div>
        <p style="color: #555; margin-top: 15px; font-style: italic;">अगला संदेश देखने के लिए दाएं या बाएं स्वाइप करें</p>
        <div id="share-generated-message-strip" class="footer-strip" style="margin-top: 20px;">
             <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="#FFFFFF"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M.05 22c.12-.59.25-1.18.41-1.76l.09-.32c.31-1.09.7-2.14 1.18-3.15.53-1.12 1.16-2.19 1.88-3.18.82-1.1 1.74-2.1 2.76-3 .2-.18.4-.36.6-.53l.4-.33c.53-.44 1.1-.82 1.7-1.14.99-.53 2.03-.9 3.1-1.1.33-.07.67-.12 1.01-.16.29-.03.59-.05.88-.05.23 0 .46.01.69.03.37.03.74.08 1.1.15.99.19 1.94.55 2.83 1.06.88.5 1.69 1.14 2.41 1.89s1.25 1.53 1.75 2.41c.45.83.78 1.71 1 2.62.22.91.31 1.85.28 2.79-.03.95-.2 1.89-.51 2.79-.31.9-.76 1.76-1.33 2.55-.57.79-1.25 1.5-2.02 2.11-.78.6-1.63 1.1-2.54 1.49-.91.38-1.88.64-2.86.76-.98.12-1.97.1-2.95-.05-.98-.15-1.95-.44-2.88-.86a12.926 12.926 0 01-2.7-1.48c-.24-.13-.47-.27-.7-.41l-1.68-1.02c-.55-.33-1.1-.68-1.64-1.05-.1-.07-.2-.14-.3-.21l-.06-.05c-.62-.48-1.2-1-1.73-1.57-.49-.52-.93-1.08-1.32-1.68-.3-.46-.55-.95-.77-1.45l-.02-.06c-.25-.56-.47-1.14-.65-1.73l-.04-.13c-.22-.72-.39-1.46-.5-2.22-.05-.33-.08-.67-.1-1H.05zM9.3 8.35c.14-.38.33-.74.58-1.06.25-.32.55-.6.88-.82.34-.22.7-.4 1.08-.52s.78-.18 1.18-.18c.39 0 .78.04 1.15.13.37.09.73.23 1.06.41.33.18.64.41.91.68.27.27.5.58.68.91.18.33.31.69.4 1.06.09.37.13.76.13 1.15s-.04.78-.13 1.15c-.09.37-.22.73-.4 1.06-.18.33-.41.64-.68.91-.27.27-.58.5-.91.68-.33.18-.69.32-1.06.41-.37-.09-.76.13-1.15.13s-.78-.04-1.15-.13c-.37-.09-.73-.23-1.06-.41-.33-.18-.64-.41-.91-.68-.27-.27-.5-.58-.68-.91-.18-.33-.31-.69-.4-1.06-.09-.37-.13-.76-.13-1.15s.05-.78.14-1.15z"/></svg>
            <span>इस संदेश को शेयर करें</span>
        </div>
        <a href="#" class="back-link" data-target="message-name-form-page">वापस जाएं</a>
    </div>
</div>

<!-- Page 10: Card Message Input Page -->
<div id="card-message-input-page" class="page">
    <div class="form-container">
        <h2>अपना संदेश लिखें</h2>
        <div class="input-group">
            <textarea id="card-wish-input" class="input-field" placeholder="यहां अपनी शुभकामना लिखें..." required rows="5"></textarea>
        </div>
        <button id="go-to-editor-btn" class="cta-button">इमेज बनाएं</button>
        <a href="#" class="back-link" data-target="home-page">वापस जाएं</a>
    </div>
</div>

<!-- Page 11: Card Editor Page -->
<div id="card-editor-page" class="page">
    <div class="editor-header">
        <button id="editor-back-btn" class="editor-btn">वापस</button>
        <a id="editor-download-btn" class="editor-btn download-btn" href="#" download="rakhi-wish.png">डाउनलोड</a>
    </div>
    <canvas id="editor-canvas"></canvas>
    <div id="card-gallery" class="card-gallery-container">
    </div>
</div>

<!-- Page 12: Receive Shared Greeting Page -->
<div id="receive-greeting-page" class="page">
    <div class="form-container">
        <h2>प्राप्त संदेश देखें</h2>
        <form id="receive-greeting-form">
            <div class="input-group">
                <input type="text" id="greeting-code-input" class="input-field" placeholder="यहां 5 अंकों का कोड डालें" required maxlength="5" style="text-transform: uppercase;">
            </div>
            <button type="submit" class="cta-button">संदेश देखें</button>
        </form>
         <a href="#" class="back-link" data-target="home-page">होम पर जाएं</a>
    </div>
</div>

<!-- Page 13: Display Final Greeting -->
<div id="final-greeting-display-page" class="page">
    <div class="form-container">
        <h2>आपके लिए एक विशेष संदेश</h2>
        <div id="final-greeting-message"></div>
    </div>
</div>


<!-- Firebase SDKs -->
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
    import { getFirestore, doc, setDoc, getDoc, updateDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";
    
    const firebaseConfig = {
        apiKey: "AIzaSyB2PG5JvDko2UmQDlY9gN5lBgga2vQy-Ws",
        authDomain: "conceptra-c1000.firebaseapp.com",
        databaseURL: "https://conceptra-c1000-default-rtdb.firebaseio.com",
        projectId: "conceptra-c1000",
        storageBucket: "conceptra-c1000.firebasestorage.app",
        messagingSenderId: "298402987968",
        appId: "1:298402987968:web:c0d0d7d6c08cdfa6bc5225",
        measurementId: "G-QRQYEVSJJ6"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const pages = document.querySelectorAll('.page');
    const audio = document.getElementById('background-audio');
    const speakerIcon = document.getElementById('speaker-icon');
    let isMusicPlaying = false;
    let fallingElementsInterval;
    
    let messageType = ''; 
    let currentMessageIndex = 0;

    // --- NEW: Significantly Longer Messages ---
    const messages = {
        'bhai-to-bhen': [
            "मेरी प्यारी बहना, रक्षाबंधन के इस पावन अवसर पर, मैं तुम्हें सिर्फ एक धागा नहीं, बल्कि अपने हृदय की गहराइयों से निकला हुआ स्नेह और विश्वास भेज रहा हूँ। यह रेशम का धागा हमारे उस अनमोल रिश्ते का प्रतीक है, जो बचपन की खिलखिलाहटों, आँगन की धमाचौकड़ी और एक-दूसरे के राज़ों को सहेजने से बना है। मुझे आज भी याद है, कैसे तुम मेरे लिए माँ से लड़ जाती थी और कैसे मेरी हर छोटी-बड़ी जीत पर मुझसे ज़्यादा खुश होती थी। तुम्हारी राखी जब मेरी कलाई पर सजती है, तो यह सिर्फ एक धागा नहीं, बल्कि एक अभेद्य कवच बन जाती है, जो मुझे जीवन की हर चुनौती का सामना करने की शक्ति देती है। मैं ईश्वर से प्रार्थना करता हूँ कि तुम्हारे जीवन का हर पल खुशियों के रंगों से सराबोर हो, तुम्हारी आँखों में कभी कोई आँसू न आए और तुम्हारे चेहरे की यह मुस्कान सदा यूँ ही खिली रहे। चाहे हम कितने भी दूर क्यों न हों, मेरा स्नेह और मेरी शुभकामनाएँ हमेशा तुम्हारे साथ हैं। तुम्हारा भाई होने पर मुझे गर्व है।",
            "प्रिय बहन, आज जब मैं पीछे मुड़कर देखता हूँ, तो हमारा बचपन किसी खूबसूरत फिल्म की तरह आँखों के सामने घूम जाता है। वो तुम्हारा मेरे टिफिन से चोरी-छुपे खाना, वो रिमोट के लिए हमारी कभी न खत्म होने वाली लड़ाई, और फिर कुछ ही पलों में सब कुछ भूलकर एक हो जाना। ये छोटी-छोटी खट्टी-मीठी यादें ही हमारे रिश्ते की सबसे बड़ी दौलत हैं। तुमने मुझे एक भाई होने का सही अर्थ समझाया है। तुमने मुझे सिखाया कि रिश्ता सिर्फ खून का नहीं, बल्कि भावनाओं, सम्मान और एक-दूसरे की परवाह का होता है। यह राखी का त्योहार मुझे हर साल यह याद दिलाने आता है कि मेरे पास तुम्हारी जैसी एक अनमोल दोस्त है, जो हर परिस्थिति में मेरे साथ चट्टान की तरह खड़ी रहती है। मैं वादा करता हूँ कि तुम्हारे जीवन के हर सुख-दुख में, हर उतार-चढ़ाव में, मैं हमेशा तुम्हारी ढाल बनकर खड़ा रहूँगा। तुम्हारी हर इच्छा पूरी हो, तुम्हारे हर सपने को पंख लगें, यही मेरी दिल से कामना है। तुम्हें रक्षाबंधन की ढेर सारी शुभकामनाएँ।",
            "मेरी सबसे प्यारी बहना, समय कितनी तेज़ी से पंख लगाकर उड़ जाता है, पता ही नहीं चलता। कल की ही तो बात लगती है, जब तुम नन्ही सी गुड़िया थी और मैं तुम्हारा रक्षक। आज तुम खुद इतनी समझदार और मजबूत हो गई हो कि दुनिया का सामना कर सको, यह देखकर मेरा सीना गर्व से चौड़ा हो जाता है। फिर भी, मेरे लिए तुम हमेशा वही छोटी बहन रहोगी, जिसकी फिक्र मुझे हमेशा रहती है। यह राखी का धागा हमारे बीच की दूरी को मिटा देता है और हमारे दिलों को और भी करीब ले आता है। यह मुझे मेरे उस कर्तव्य की याद दिलाता है जो मैंने तुम्हारे प्रति जीवन भर निभाने का संकल्प लिया है - तुम्हारी रक्षा, तुम्हारा सम्मान और तुम्हारा साथ। भगवान तुम्हें दुनिया की हर नेमत से नवाज़े। तुम्हारा जीवन सफलता, स्वास्थ्य और समृद्धि से परिपूर्ण हो। इस विशेष दिन पर तुम्हें बहुत सारा प्यार और आशीर्वाद भेज रहा हूँ।",
            "बहन, रक्षाबंधन का यह दिन सिर्फ एक त्योहार नहीं, बल्कि हमारे अटूट बंधन का उत्सव है। यह उस रिश्ते का जश्न है जिसमें प्यार भी है, तकरार भी है, परवाह भी है और एक-दूसरे पर अटूट विश्वास भी है। तुम्हारे बिना मेरा जीवन अधूरा है। तुम वो इंसान हो जिसके साथ मैं अपनी हर खुशी और हर गम बिना किसी झिझक के बाँट सकता हूँ। तुम्हारी सलाह मेरे लिए हमेशा मार्गदर्शक रही है और तुम्हारा हौसला मेरी सबसे बड़ी ताकत। आज इस पवित्र दिन पर मैं सर्वशक्तिमान से प्रार्थना करता हूँ कि वह तुम्हें हर बुरी नज़र से बचाए, तुम्हारे पथ को सफलता के फूलों से सजाए और हमारे इस खूबसूरत रिश्ते को जन्म-जन्मांतर तक बनाए रखे। मेरी कलाई तुम्हारे प्यार के धागे के बिना सूनी है। जल्दी से अपनी राखी भेज दो। तुम्हें रक्षाबंधन की हार्दिक बधाई।",
            "मेरी लाडली बहन, कैसे कहूँ कि तुम मेरे लिए क्या हो। तुम मेरी दोस्त, मेरी मार्गदर्शक, और कभी-कभी तो मेरी माँ भी बन जाती हो। तुम्हारे गुस्से में भी प्यार छुपा होता है और तुम्हारी डांट में भी परवाह। तुम्हारे हाथों से बंधी राखी सिर्फ एक धागा नहीं, बल्कि एक ऐसा सुरक्षा चक्र है जो मुझे हर नकारात्मकता से दूर रखता है। मुझे याद है बचपन में जब मैं गिर जाता था, तो चोट मुझे लगती थी और आँसू तुम्हारी आँखों से बहते थे। यही निस्वार्थ प्रेम हमारे रिश्ते की बुनियाद है। मैं तुमसे वादा करता हूँ कि जीवन के किसी भी मोड़ पर जब भी तुम्हें मेरी ज़रूरत महसूस होगी, तुम मुझे अपने पास पाओगी। तुम्हारा हर सपना मेरा सपना है और तुम्हारी हर खुशी मेरी मंजिल। ईश्वर करे हमारा यह प्यार भरा बंधन हमेशा यूँ ही बना रहे। हैप्पी रक्षाबंधन, मेरी प्यारी बहन।"
        ],
        'bhen-to-bhai': [
            "मेरे प्यारे भाई, तुम्हारी कलाई पर यह राखी बांधते हुए मेरा हृदय गर्व और स्नेह से भर जाता है। यह सिर्फ एक रेशम का धागा नहीं, यह मेरी वो अनगिनत प्रार्थनाएँ हैं जो मैं हर पल तुम्हारी सलामती और सफलता के लिए करती हूँ। तुम मेरे जीवन के वो पहले दोस्त हो जिसने मुझे उंगली पकड़कर चलना सिखाया और दुनिया का सामना करने का हौसला दिया। बचपन की वो धुंधली यादें आज भी मेरे मन में ताज़ा हैं - वो तुम्हारा मुझे चिढ़ाना, फिर मेरा रोना और फिर तुम्हारा ही मुझे हँसाना। तुमने मुझे हमेशा एक राजकुमारी की तरह सहेज कर रखा है। तुम्हारे होते हुए मुझे कभी किसी बात का डर नहीं सताया। यह राखी का धागा तुम्हें याद दिलाएगा कि तुम्हारी एक बहन है जो मीलों दूर होकर भी हमेशा तुम्हारे दिल के सबसे करीब है। भगवान तुम्हें लंबी आयु, अच्छा स्वास्थ्य और जीवन में वो हर खुशी दे जिसके तुम हकदार हो। रक्षाबंधन की बहुत-बहुत शुभकामनाएँ, भैया।",
            "प्रिय भाई, आज रक्षाबंधन के इस खास दिन पर, मैं तुम्हें बताना चाहती हूँ कि तुम मेरे लिए कितने महत्वपूर्ण हो। तुम सिर्फ मेरे भाई नहीं, बल्कि मेरे सुपरहीरो हो, मेरे विश्वासपात्र हो और मेरे सबसे बड़े समर्थक हो। जब भी मैं जीवन में डगमगाई, तुमने मेरा हाथ थामकर मुझे सही रास्ता दिखाया। तुम्हारी डांट में भी मेरे लिए चिंता छुपी होती है और तुम्हारे दिए गए उपहारों से ज़्यादा कीमती तुम्हारा साथ है। यह राखी का बंधन हमारे प्यार और विश्वास का प्रतीक है। मैं प्रार्थना करती हूँ कि हमारा यह रिश्ता समय के साथ और भी गहरा और मजबूत होता जाए। ईश्वर तुम्हारी हर मनोकामना पूरी करे और तुम्हें जीवन के हर क्षेत्र में शिखर पर पहुँचाए। तुम्हारी कलाई पर बंधा यह धागा तुम्हें हर বিপদ से बचाए और तुम्हें मेरी याद दिलाता रहे। लव यू भैया, हैप्पी राखी।",
            "मेरे दुनिया के सबसे अच्छे भाई, रक्षाबंधन की हार्दिक शुभकामनाएँ। यह त्योहार मुझे हमेशा हमारे खूबसूरत बचपन की याद दिलाता है। वो साथ में खेले गए खेल, वो हमारी छोटी-छोटी शरारतें, और वो एक-दूसरे के लिए अटूट प्यार। समय ने हमें बड़ा कर दिया और शायद दूर भी, लेकिन हमारे दिलों में एक-दूसरे के लिए जो जगह है, वो कभी कम नहीं हो सकती। तुम्हारी सफलता पर मुझसे ज़्यादा कोई खुश नहीं होता और तुम्हारी परेशानी में मुझसे ज़्यादा कोई दुखी नहीं होता। यह राखी मेरी तरफ से तुम्हारे लिए एक सुरक्षा कवच है। यह तुम्हें हर बुरी नज़र से बचाएगी और तुम्हारे जीवन को सकारात्मक ऊर्जा से भर देगी। मैं हमेशा तुम्हारे साथ हूँ, चाहे परिस्थितियाँ कैसी भी हों। तुम सदा खुश रहो, मुस्कुराते रहो, यही मेरी ईश्वर से प्रार्थना है।",
            "भैया, आज का दिन कितना पवित्र और सुंदर है। यह दिन भाई-बहन के निस्वार्थ प्रेम को समर्पित है। तुम्हारी कलाई के लिए यह राखी भेज रही हूँ, इसे सिर्फ धागा मत समझना, इसमें मेरा सारा स्नेह, मेरी सारी दुआएँ और तुम्हारे लिए मेरा अटूट विश्वास लिपटा हुआ है। तुम मेरे अभिमान हो। जब कोई मुझे तुम्हारे नाम से जानता है, तो मेरा सिर गर्व से ऊँचा हो जाता है। तुमने मुझे हमेशा बेहतर करने के लिए प्रेरित किया है और मेरे सपनों को पूरा करने में मेरी मदद की है। तुम्हारे जैसा भाई पाकर मैं खुद को बहुत भाग्यशाली मानती हूँ। मैं कामना करती हूँ कि तुम्हारे जीवन में कभी कोई गम न आए और खुशियों का कारवाँ हमेशा तुम्हारे साथ चले। यह रक्षाबंधन हमारे रिश्ते में और भी मिठास घोले।",
            "मेरे प्यारे भाई, यह राखी का धागा गवाह है हमारे उस अनोखे रिश्ते का, जिसमें नोक-झोंक भी है और बेपनाह मोहब्बत भी। तुम वो इंसान हो जिसने मुझे सिखाया कि गिरकर उठना और फिर से मुस्कुराना किसे कहते हैं। तुम्हारी छत्रछाया में मैंने खुद को हमेशा सुरक्षित महसूस किया है। आज इस पावन पर्व पर, मैं तुम्हें यह विश्वास दिलाना चाहती हूँ कि तुम्हारी यह बहन हमेशा तुम्हारे साथ खड़ी रहेगी, एक दोस्त बनकर, एक सलाहकार बनकर। तुम्हारी हर मुश्किल मेरी मुश्किल होगी और तुम्हारी हर जीत मेरी जीत। यह राखी का बंधन हमें हमेशा जोड़े रखेगा। ईश्वर से प्रार्थना है कि वह तुम्हें शक्ति, साहस और समृद्धि प्रदान करे। तुम्हारी ज़िंदगी खुशियों का गुलदस्ता बने। हैप्पी रक्षाबंधन, मेरे प्यारे भाई।"
        ]
    };

    const mainVideoPlayer = document.getElementById('main-video-player');
    const mainInterfaceVideos = [
        'main interfacemp4.mp4', 
        'coming soon rakshabandhan __ 9 August 2025 _comingsoon _rakhi_happyrakshabandhan_status_short(360P).mp4', 
        'main interface 3.mp4', 
        'Happy Rakshabandhan 🎊✨🪔 __ Coming soon 🎊 __ _rakshabandhan _status _viral(360P).mp4', 
        'main interface 4.mp4'
    ];
    let currentMainVideoIndex = 0;
    
    function showPage(pageId) {
        const activePage = document.querySelector('.page.active');
        if (activePage) {
            if (activePage.id === 'main-interface-page') {
                mainVideoPlayer.pause();
                if (localStorage.getItem('musicWasPlaying') === 'true' && audio.paused) {
                    audio.play().catch(()=>{});
                }
            }
        }

        pages.forEach(p => p.classList.remove('active'));
        const page = document.getElementById(pageId);
        if (page) {
            page.classList.add('active');
        }

        if (pageId === 'main-interface-page') {
            startFallingElements();
            if (!audio.paused) {
                audio.pause();
                localStorage.setItem('musicWasPlaying', 'true');
            } else {
                localStorage.setItem('musicWasPlaying', 'false');
            }
            mainVideoPlayer.muted = false; // Unmute the video on this page
            mainVideoPlayer.play().catch(e => console.log("Autoplay was prevented."));
        } else {
            if(fallingElementsInterval) clearInterval(fallingElementsInterval);
        }
        
        if (pageId === 'profile-page') {
            loadProfileForEditing();
        }
    }

    async function loadProfileForEditing() {
        const userId = localStorage.getItem('rakshaSutraUserId');
        if (!userId) {
            alert("प्रोफ़ाइल देखने के लिए आपका पंजीकृत होना आवश्यक है।");
            showPage('form-page');
            return;
        }

        document.getElementById('profile-call-id').textContent = userId;

        try {
            const userDocRef = doc(db, "users", userId);
            const docSnap = await getDoc(userDocRef);

            if (docSnap.exists()) {
                const userData = docSnap.data();
                document.getElementById('profile-name-input').value = userData.name || '';
                document.getElementById('profile-address-input').value = userData.address || '';
            } else {
                console.log("No such document!");
                alert("आपकी प्रोफ़ाइल का डेटा नहीं मिला।");
                localStorage.clear();
                showPage('form-page');
            }
        } catch (error) {
            console.error("Error getting document:", error);
            alert("आपकी प्रोफ़ाइल लोड करते समय एक त्रुटि हुई: " + error.message);
        }
    }
    
    function toggleMusic() {
        if (audio.paused) {
            audio.play().then(() => {
                speakerIcon.textContent = '🔊';
                isMusicPlaying = true;
            }).catch(() => { isMusicPlaying = false; });
        } else {
            audio.pause();
            speakerIcon.textContent = '🔇';
            isMusicPlaying = false;
        }
    }
    
    function startFallingElements() {
        if (fallingElementsInterval) clearInterval(fallingElementsInterval);
        const container = document.getElementById('falling-elements-container');
        container.innerHTML = '';
        const elements = ['🌺', '🌹', '🌸', '🌷', '🌼', '🏵️', '💮', '☘️', '🍁'];
        fallingElementsInterval = setInterval(() => {
            const element = document.createElement('div');
            element.className = 'falling-element';
            element.textContent = elements[Math.floor(Math.random() * elements.length)];
            element.style.left = Math.random() * 100 + 'vw';
            element.style.animationDuration = Math.random() * 5 + 5 + 's';
            element.style.fontSize = Math.random() * 1.5 + 1 + 'rem';
            container.appendChild(element);
            setTimeout(() => { element.remove(); }, 10000);
        }, 300);
    }

    function speakMessage(text) {
        if (!window.speechSynthesis) return;
        window.speechSynthesis.cancel();
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = 'hi-IN';
        utterance.rate = 0.9;
        utterance.pitch = 1.1;
        window.speechSynthesis.speak(utterance);
    }

    function setupMainInterfacePage(userName) {
        const messageText = `प्रिय ${userName},\n\nरक्षा बंधन की हार्दिक शुभकामनाएँ!\nयह पावन पर्व हमारे रिश्ते की डोर को और भी मज़बूत करता है। ईश्वर से यही प्रार्थना है कि हमारे रिश्ते की मिठास कभी कम न हो और जीवन में हर खुशी आपके कदम चूमे।`;
        document.getElementById('main-interface-message').textContent = messageText;
        mainVideoPlayer.src = mainInterfaceVideos[currentMainVideoIndex];
        showPage('main-interface-page');
        setTimeout(() => speakMessage(messageText), 1500);
    }
    
    function playNextMainVideo() {
        currentMainVideoIndex = (currentMainVideoIndex + 1) % mainInterfaceVideos.length;
        mainVideoPlayer.src = mainInterfaceVideos[currentMainVideoIndex];
        mainVideoPlayer.play();
    }
    
    function displayCurrentMessage() {
        const sender = document.getElementById('sender-name').value;
        const receiver = document.getElementById('receiver-name').value;
        let messageTemplate = messages[messageType][currentMessageIndex];
        
        let formattedMessage = messageTemplate.replace(/मेरी प्यारी बहना/g, `मेरी प्यारी बहना ${receiver}`)
                                            .replace(/प्रिय बहन/g, `प्रिय बहन ${receiver}`)
                                            .replace(/मेरी सबसे प्यारी बहना/g, `मेरी सबसे प्यारी बहना ${receiver}`)
                                            .replace(/बहन,/g, `बहन ${receiver},`)
                                            .replace(/मेरी लाडली बहन/g, `मेरी लाडली बहन ${receiver}`)
                                            .replace(/मेरे प्यारे भाई/g, `मेरे प्यारे भाई ${receiver}`)
                                            .replace(/प्रिय भाई/g, `प्रिय भाई ${receiver}`)
                                            .replace(/मेरे दुनिया के सबसे अच्छे भाई/g, `मेरे दुनिया के सबसे अच्छे भाई ${receiver}`)
                                            .replace(/भैया,/g, `भैया ${receiver},`);

        document.getElementById('message-display-card').textContent = formattedMessage + `\n\nतुम्हारा/तुम्हारी,\n${sender}`;
    }

    async function shareGeneratedMessage() {
        const shareButton = document.getElementById('share-generated-message-strip');
        shareButton.style.pointerEvents = 'none';
        shareButton.style.opacity = '0.7';

        const messageToShare = document.getElementById('message-display-card').textContent;
        const receiverName = document.getElementById('receiver-name').value;
        
        // Generate a random 5-character ID
        const greetingId = Math.random().toString(36).substring(2, 7).toUpperCase();

        try {
            await setDoc(doc(db, "sharedGreetings", greetingId), { 
                message: messageToShare, 
                createdAt: serverTimestamp() 
            });

            const shareText = `नमस्ते ${receiverName}, आपके लिए एक विशेष रक्षाबंधन संदेश है।\n\nइसे देखने के लिए, इस लिंक पर जाएं: ${window.location.origin}\n\nऔर होम पेज पर 'प्राप्त संदेश देखें' पर क्लिक करके यह कोड डालें: *${greetingId}*`;
            const whatsappUrl = `https://api.whatsapp.com/send?text=${encodeURIComponent(shareText)}`;
            
            window.open(whatsappUrl, '_blank');
            alert(`आपका संदेश कोड है: ${greetingId}\n\nयह कोड और ऐप का लिंक आपके मित्र के साथ व्हाट्सएप पर साझा किया जा रहा है।`);

        } catch (error) {
            console.error("Error sharing greeting: ", error);
            alert("संदेश साझा करते समय एक त्रुटि हुई: " + error.message + "\n\nकृपया सुनिश्चित करें कि आपने फायरबेस सुरक्षा नियमों को अपडेट किया है।");
        } finally {
            shareButton.style.pointerEvents = 'auto';
            shareButton.style.opacity = '1';
        }
    }


    // --- Event Listeners ---

    window.addEventListener('load', () => {
        if (localStorage.getItem('rakshaSutraUserId')) {
             // If user is already registered, go to home page directly
             showPage('home-page'); 
        } else {
             // Otherwise, show the landing page
             showPage('landing-page');
        }
    });

    speakerIcon.addEventListener('click', toggleMusic);

    document.getElementById('get-started-btn').addEventListener('click', () => {
        audio.play().then(() => audio.pause()).catch(() => {});
        if (localStorage.getItem('rakshaSutraUserId')) {
            setupMainInterfacePage(localStorage.getItem('rakshaSutraUserName'));
        } else {
            showPage('form-page');
        }
    });

    document.getElementById('info-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        const submitButton = e.target.querySelector('button[type="submit"]');
        submitButton.disabled = true;
        submitButton.textContent = 'सबमिट हो रहा है...';

        const phone = document.getElementById('phone').value;
        const name = document.getElementById('name').value;
        const address = document.getElementById('address').value;

        try {
            await setDoc(doc(db, "users", phone), { 
                name: name, 
                phone: phone, 
                address: address, 
                timestamp: serverTimestamp() 
            });
            localStorage.setItem('rakshaSutraUserName', name);
            localStorage.setItem('rakshaSutraUserId', phone);
            alert(`धन्यवाद, ${name}! आपकी प्रोफ़ाइल बन गई है।\nआपकी आईडी है: ${phone}`);
            setupMainInterfacePage(name);
        } catch (error) {
            console.error("Error writing document: ", error);
            alert("एक त्रुटि हुई: " + error.message);
        } finally {
            submitButton.disabled = false;
            submitButton.textContent = 'सबमिट करें';
        }
    });

    mainVideoPlayer.addEventListener('ended', playNextMainVideo);

    document.getElementById('mystery-box-btn').addEventListener('click', () => showPage('home-page'));

    document.getElementById('update-profile-btn').addEventListener('click', async () => {
        const updateButton = document.getElementById('update-profile-btn');
        const userId = localStorage.getItem('rakshaSutraUserId');
        if (!userId) { return; }

        const newName = document.getElementById('profile-name-input').value;
        const newAddress = document.getElementById('profile-address-input').value;
        if (!newName || !newAddress) { alert("नाम और पता खाली नहीं हो सकता।"); return; }
        
        updateButton.disabled = true;
        updateButton.textContent = 'अपडेट हो रहा है...';
        const userDocRef = doc(db, "users", userId);
        try {
            await updateDoc(userDocRef, { name: newName, address: newAddress });
            localStorage.setItem('rakshaSutraUserName', newName);
            alert("प्रोफ़ाइल सफलतापूर्वक अपडेट की गई!");
        } catch (error) {
            console.error("Error updating document: ", error);
            alert("अपडेट करते समय एक त्रुटि हुई: " + error.message);
        } finally {
            updateButton.disabled = false;
            updateButton.textContent = 'प्रोफाइल अपडेट करें';
        }
    });

    document.getElementById('message-card-btn').addEventListener('click', () => showPage('message-creator-page'));
    document.getElementById('open-message-creator-btn').addEventListener('click', () => showPage('message-creator-page'));
    document.getElementById('card-creator-btn').addEventListener('click', () => showPage('card-message-input-page'));
    document.getElementById('open-card-creator-btn').addEventListener('click', () => showPage('card-message-input-page'));
    document.getElementById('change-music-strip').addEventListener('click', () => showPage('music-page'));
    document.getElementById('my-profile-strip').addEventListener('click', () => showPage('profile-page'));
    document.getElementById('view-shared-strip').addEventListener('click', () => showPage('receive-greeting-page'));

    document.getElementById('whatsapp-share-strip').addEventListener('click', () => {
        const message = encodeURIComponent(`इस रक्षाबंधन, अपने भाई-बहन को एक विशेष डिजिटल राखी भेजें! इस खूबसूरत वेबसाइट को देखें: ${window.location.href}`);
        const whatsappUrl = `https://api.whatsapp.com/send?text=${message}`;
        window.open(whatsappUrl, '_blank');
    });

    document.querySelectorAll('.back-link').forEach(link => {
        link.addEventListener('click', (e) => {
            e.preventDefault();
            showPage(link.dataset.target);
        });
    });
    
    document.querySelectorAll('.music-btn').forEach(button => {
        button.addEventListener('click', () => {
            audio.src = button.dataset.src;
            if (isMusicPlaying) {
                 audio.play();
            } else {
                toggleMusic();
            }
            showPage('home-page');
        });
    });
    
    document.getElementById('bhai-to-bhen-btn').addEventListener('click', () => { messageType = 'bhai-to-bhen'; showPage('message-name-form-page'); });
    document.getElementById('bhen-to-bhai-btn').addEventListener('click', () => { messageType = 'bhen-to-bhai'; showPage('message-name-form-page'); });
    
    document.getElementById('message-name-form').addEventListener('submit', (e) => {
        e.preventDefault();
        currentMessageIndex = 0;
        displayCurrentMessage();
        showPage('message-display-page');
    });
    
    let messageTouchStartX = 0;
    const messageCard = document.getElementById('message-display-page');
    messageCard.addEventListener('touchstart', e => { messageTouchStartX = e.changedTouches[0].screenX; }, { passive: true });
    messageCard.addEventListener('touchend', e => {
        const touchendX = e.changedTouches[0].screenX;
        const totalMessages = messages[messageType].length;
        if (touchendX < messageTouchStartX - 50) {
            currentMessageIndex = (currentMessageIndex + 1) % totalMessages;
            displayCurrentMessage();
        }
        if (touchendX > messageTouchStartX + 50) {
            currentMessageIndex = (currentMessageIndex - 1 + totalMessages) % totalMessages;
            displayCurrentMessage();
        }
    });

    document.getElementById('share-generated-message-strip').addEventListener('click', shareGeneratedMessage);
    
    document.getElementById('receive-greeting-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        const submitBtn = e.target.querySelector('button[type="submit"]');
        const codeInput = document.getElementById('greeting-code-input');
        const code = codeInput.value.trim().toUpperCase();

        if (code.length < 4) {
            alert("कृपया एक मान्य कोड डालें।");
            return;
        }

        submitBtn.disabled = true;
        submitBtn.textContent = "खोज रहा है...";

        try {
            const docRef = doc(db, "sharedGreetings", code);
            const docSnap = await getDoc(docRef);

            if (docSnap.exists()) {
                const data = docSnap.data();
                document.getElementById('final-greeting-message').textContent = data.message;
                showPage('final-greeting-display-page');

                setTimeout(() => {
                    if(document.getElementById('final-greeting-display-page').classList.contains('active')){
                        showPage('home-page');
                    }
                }, 5000); // 5 सेकंड बाद होम पेज पर वापस
            } else {
                alert("गलत कोड। कृपया पुनः प्रयास करें या प्रेषक से पुष्टि करें।");
            }
        } catch (error) {
            console.error("Error fetching greeting:", error);
            alert("संदेश प्राप्त करते समय एक त्रुटि हुई।");
        } finally {
            submitBtn.disabled = false;
            submitBtn.textContent = "संदेश देखें";
            codeInput.value = '';
        }
    });

</script>
</body>
</html>
