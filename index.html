<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Raksha Sutra</title>
    <style>
        /* --- Google Fonts --- */
        @import url('https://fonts.googleapis.com/css2?family=Tiro+Devanagari+Hindi:wght@400&family=Poppins:wght@400;600;700&display=swap');

    /* --- CSS Variables --- */
    :root {
        --primary-color: #e94d6e;
        --secondary-color: #f06595;
        --text-color: #34495e;
        --light-text-color: #f0f0f0;
        --card-bg: rgba(255, 255, 255, 0.4);
        --blur-effect: blur(10px);
    }

    /* --- General Styles --- */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body { height: 100%; }

    body {
        font-family: 'Poppins', sans-serif;
        overflow: hidden;
        color: var(--text-color);
        position: relative; 
    }
    
    body::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: url('Leonardo_Phoenix_10_A_beautiful_festive_background_for_a_Raks_3.jpg') no-repeat center center/cover;
        filter: blur(8px);
        z-index: -1; 
    }
    
    /* --- Page Container --- */
    .page {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        width: 100%;
        height: 100%;
        position: absolute;
        top: 0;
        left: 0;
        transition: opacity 0.7s ease-in-out, transform 0.7s ease-in-out;
        opacity: 0;
        transform: scale(0.95);
        pointer-events: none;
        padding: 20px;
        text-align: center;
        overflow-y: auto;
    }

    .page.active {
        opacity: 1;
        transform: scale(1);
        pointer-events: auto;
    }

    /* --- Landing Page --- */
    .title {
        font-family: 'Tiro Devanagari Hindi', serif;
        font-size: clamp(2.8rem, 8vw, 4.5rem);
        color: #fff;
        text-shadow: 3px 3px 10px rgba(0, 0, 0, 0.5);
        margin-bottom: 20px;
    }

    .video-card {
        position: relative;
        width: 90vw;
        max-width: 600px;
        aspect-ratio: 16 / 9;
        background: var(--card-bg);
        backdrop-filter: var(--blur-effect);
        border: 1px solid rgba(255, 255, 255, 0.3);
        border-radius: 20px;
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
        overflow: hidden;
    }

    .video-card video { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; }
    .subtitle { margin-top: 25px; font-size: clamp(0.9rem, 2.5vw, 1.1rem); color: var(--light-text-color); max-width: 600px; text-shadow: 2px 2px 6px rgba(0, 0, 0, 0.5); padding: 0 15px; }

    .cta-button {
        padding: 15px 40px;
        font-size: 1.1rem;
        font-weight: 600;
        color: #fff;
        background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
        border: none;
        border-radius: 50px;
        cursor: pointer;
        text-decoration: none;
        box-shadow: 0 10px 25px rgba(233, 77, 110, 0.4);
        transition: all 0.3s ease;
        margin-top: 20px;
    }
    .cta-button:hover { transform: translateY(-5px); box-shadow: 0 15px 30px rgba(233, 77, 110, 0.5); }
    .cta-button:disabled { background: #ccc; cursor: not-allowed; }

    /* --- Speaker Icon --- */
    #speaker-icon { position: fixed; top: 20px; right: 20px; font-size: 1.8rem; color: white; cursor: pointer; z-index: 1000; text-shadow: 2px 2px 5px rgba(0,0,0,0.4); }

    /* --- Form & Profile Page --- */
    .form-container { width: 90%; max-width: 450px; padding: 40px 30px; background: var(--card-bg); backdrop-filter: var(--blur-effect); border: 1px solid rgba(255, 255, 255, 0.4); border-radius: 20px; box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2); }
    .form-container h2 { font-family: 'Poppins', serif; font-size: 2rem; color: var(--text-color); margin-bottom: 30px; }
    .input-group { margin-bottom: 20px; position: relative;}
    .input-field { width: 100%; padding: 15px; border: 1px solid rgba(0,0,0,0.1); border-radius: 10px; background-color: rgba(255,255,255,0.7); font-size: 1rem; color: var(--text-color); }
    .back-link { display: inline-block; margin-top: 15px; color: var(--text-color); text-decoration: none; font-weight: 600; }
    
    /* --- Home Page --- */
    #home-page { justify-content: space-between; padding: 80px 20px 20px 20px; }
    .home-header { position: absolute; top: 0; left: 0; width: 100%; padding: 20px; background: rgba(0,0,0,0.2); backdrop-filter: blur(5px); z-index: 10; }
    .home-header .title { margin: 0; font-size: 2rem; text-align: center; }
    #home-page .content-area { display: flex; flex-direction: column; align-items: center; width: 100%; gap: 25px; max-width: 500px; flex-grow: 1; justify-content: center; }
    .cards-container { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; width: 100%; }
    .home-card-wrapper { display: flex; flex-direction: column; align-items: center; gap: 15px; }
    .home-card { width: 100%; aspect-ratio: 1 / 1; background-size: cover; background-position: center; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); cursor: pointer; transition: transform 0.3s ease; }
    .home-card:hover { transform: scale(1.05); }
    #home-page .cta-button { margin-top: 0; width: 100%; padding: 12px 20px; font-size: 1rem; }
    .home-footer { width: 100%; max-width: 500px; display: flex; flex-direction: column; gap: 15px; margin-top: auto; padding-top:20px; }
    .footer-strip { width: 100%; padding: 15px 25px; font-size: 1.1rem; font-weight: 600; color: #fff; background: rgba(0, 0, 0, 0.3); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 15px; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; gap: 10px; }
    
    /* --- Profile Page --- */
    #profile-page .profile-info { text-align: left; width: 100%; }
    #profile-page .profile-info p { margin-bottom: 20px; color: var(--text-color); font-weight: 600; }
    #profile-page .profile-info span { font-weight: 400; word-break: break-all; background: rgba(0,0,0,0.2); padding: 5px 8px; border-radius: 8px; color: white; text-shadow: 1px 1px 2px rgba(0,0,0,0.4); }

    /* --- Main Interface Page (Book Design) --- */
    #main-interface-page { overflow: hidden; position: relative; }
    #main-interface-page .page-content { display: flex; flex-direction: column; align-items: center; justify-content: center; width: 100%; height: 100%; position: relative; z-index: 2;}
    .book-container { display: flex; gap: 15px; perspective: 1500px;}
    .interface-card { flex-shrink: 0; width: 45vw; max-width: 280px; aspect-ratio: 9 / 16; border-radius: 20px; box-shadow: 0 20px 50px rgba(0,0,0,0.5); position: relative; border: 2px solid rgba(255,255,255,0.5); background: rgba(0, 0, 0, 0.3); backdrop-filter: blur(15px); transform-style: preserve-3d; transition: transform 1s; }
    #main-interface-page.active .video-card-book { transform: rotateY(0deg); animation: open-left-cover 2s ease-out forwards; }
    #main-interface-page.active .message-card-book { transform: rotateY(0deg); animation: open-right-cover 2s ease-out forwards; }
    .video-card-book { transform-origin: right center; transform: rotateY(-180deg); }
    .message-card-book { transform-origin: left center; transform: rotateY(180deg); }
    @keyframes open-left-cover { from { transform: rotateY(-180deg); } to { transform: rotateY(0deg); } }
    @keyframes open-right-cover { from { transform: rotateY(180deg); } to { transform: rotateY(0deg); } }
    .interface-card video { width: 100%; height: 100%; object-fit: cover; border-radius: 18px; }
    .date-display { position: absolute; top: 15px; left: 50%; transform: translateX(-50%); color: #fff; background: rgba(233, 77, 110, 0.7); padding: 5px 15px; border-radius: 12px; font-size: clamp(0.7rem, 2vw, 0.9rem); font-weight: 600; text-shadow: 1px 1px 2px rgba(0,0,0,0.2); z-index: 5; white-space: nowrap; }
    #main-interface-message-container { display: flex; flex-direction: column; justify-content: center; padding: 25px; overflow: hidden; }
    #main-interface-message { color: white; text-shadow: 1px 1px 4px rgba(0,0,0,0.8); font-size: clamp(0.85rem, 2vw, 1.1rem); line-height: 1.7; text-align: left; overflow-y: auto; height: 100%; white-space: pre-wrap; }
    #replay-speech-btn { font-size: 1.6rem; cursor: pointer; color: white; background: rgba(0,0,0,0.2); border-radius: 50%; padding: 8px; position: absolute; bottom: 15px; right: 15px; transition: transform 0.2s; }
    #replay-speech-btn:hover { transform: scale(1.1); }
    #mystery-box-btn { font-size: 4rem; cursor: pointer; background: none; border: none; animation: pulse 2s infinite; text-shadow: 0 0 15px gold; margin-bottom: 0px;}
    #open-mystery-box-btn { margin-top: 5px; padding: 10px 30px; font-size: 1rem; }
    @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
    @media (max-width: 700px) { .book-container { gap: 10px; } .interface-card { width: 45vw; } #main-interface-message { font-size: 0.8rem; line-height: 1.6; } }

    /* --- Falling Flowers Animation --- */
    #falling-elements-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; overflow: hidden; z-index: 3; pointer-events: none; }
    .falling-element { position: absolute; top: -50px; animation: fall linear infinite; font-size: 1.5rem; }
    @keyframes fall { to { transform: translateY(105vh) rotate(360deg); } }
    
    /* --- Card Viewer Page (Message Display) --- */
    #message-display-page, #custom-card-display-page, #view-shared-message-page { justify-content: flex-start; padding-top: 80px; }
    .card-viewer-header {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        padding: 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        z-index: 10;
        background: rgba(0,0,0,0.1);
        backdrop-filter: blur(5px);
    }
    .header-btn {
        padding: 10px 25px;
        font-size: 1rem;
        font-weight: 600;
        color: #fff;
        background: rgba(255,255,255,0.2);
        border: 1px solid rgba(255,255,255,0.4);
        border-radius: 25px;
        cursor: pointer;
        transition: all 0.3s;
        text-shadow: 1px 1px 3px rgba(0,0,0,0.4);
    }
    .header-btn:hover { background: rgba(255,255,255,0.4); transform: translateY(-2px); }
    .card-viewer-container {
        width: 100%;
        max-width: 400px;
        aspect-ratio: 9 / 16;
        border-radius: 20px;
        box-shadow: 0 15px 40px rgba(0,0,0,0.3);
        padding: 40px 25px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        overflow: hidden;
        background-size: cover;
        background-position: center;
        transition: background-image 0.4s ease-in-out;
        position: relative; 
    }
    .card-viewer-container::before {
        content: '';
        position: absolute;
        top: 0; left: 0; right: 0; bottom: 0;
        background: rgba(0,0,0,0.3); 
        backdrop-filter: blur(2px); 
        border-radius: 20px;
        z-index: 1;
    }
    #message-display-card, #custom-card-display-content, #view-shared-message-content {
        font-size: clamp(1rem, 4vw, 1.25rem);
        line-height: 1.7;
        color: #fff;
        font-weight: 600;
        text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.8), 0 0 15px rgba(0,0,0,0.6);
        text-align: center;
        white-space: pre-wrap;
        overflow-y: auto;
        width: 100%;
        height: 100%;
        position: relative;
        z-index: 2;
    }
    #swipe-indicator { margin-top: 20px; color: #fff; font-weight: 500; text-shadow: 1px 1px 3px rgba(0,0,0,0.5); }
    
    @keyframes fadeInScaleUp {
      from { opacity: 0; transform: scale(0.9); }
      to { opacity: 1; transform: scale(1); }
    }
    .card-animation {
        animation: fadeInScaleUp 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
    }
    

    /* --- Unique ID Modal & Shared Message Display --- */
    #unique-id-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; display: none; justify-content: center; align-items: center; z-index: 2000; flex-direction: column; background: rgba(0,0,0,0.7); }
    #unique-id-modal.active { display: flex; }
    
    .modal-button-group {
        display: flex;
        gap: 10px;
        width: 100%;
        margin-top: 10px;
    }
    .modal-button-group .cta-button {
        flex: 1;
        margin-top: 0;
    }

</style>
</head>
<body>


<audio id="background-audio" loop></audio>

<div id="speaker-icon">🔇</div>


<!-- Unique ID Input Modal -->
<div id="unique-id-modal">
    <div class="form-container">
        <h2>मित्र का संदेश देखें</h2>
        <form id="unique-id-form">
            <div class="input-group"><input type="text" id="unique-id-input" class="input-field" placeholder="प्राप्त हुआ 5-अंकीय कोड डालें" required="" maxlength="5" minlength="5"></div>
            <div class="modal-button-group">
                 <button type="button" id="close-unique-id-modal-btn" class="cta-button" style="background: #6c757d;">वापस</button>
                 <button type="submit" class="cta-button">संदेश देखें</button>
            </div>
        </form>
    </div>
</div>

<!-- Page 1: Landing Page -->
<div id="landing-page" class="page active">
    <h1 class="title">Raksha Sutra</h1>
    <div class="video-card"><video autoplay="" loop="" muted="" playsinline=""><source src="Generated File August 07, 2025 - 7_34PM.mp4" type="video/mp4"></video></div>
    <p class="subtitle">"रक्षाबंधन सिर्फ एक धागा नहीं, बल्कि दिलों का एक अटूट बंधन है।<br>आइए इस रिश्ते को फिर से महसूस करें, एक प्यार भरी डिजिटल राखी के साथ।"</p>
    <button id="get-started-btn" class="cta-button">शुरू करें</button>
</div>

<!-- Page 2: Info Form Page -->
<div id="form-page" class="page">
    <div class="form-container">
        <h2>अपनी जानकारी भरें</h2>
        <form id="info-form">
            <div class="input-group"><input type="text" id="name" class="input-field" placeholder="पूरा नाम" required=""></div>
            <div class="input-group"><input type="tel" id="phone" class="input-field" placeholder="मोबाइल नंबर (यह आपकी पहचान होगी)" required=""></div>
            <div class="input-group"><textarea id="address" rows="3" class="input-field" placeholder="पूरा पता" required=""></textarea></div>
            <button type="submit" class="cta-button">सबमिट करें</button>
        </form>
    </div>
</div>

<!-- Page 3: Main Interface Page -->
<div id="main-interface-page" class="page">
    <div id="falling-elements-container"></div>
    <div class="page-content">
        <div class="book-container">
            <!-- Video Card -->
            <div class="interface-card video-card-book">
                 <div class="date-display">शनिवार, 9 अगस्त, 2025</div>
                <video playsinline="" id="main-video-player"></video>
            </div>
            <!-- Message Card -->
            <div class="interface-card message-card-book" id="main-interface-message-container">
                <div id="main-interface-message"></div>
                <div id="replay-speech-btn">🔊</div>
            </div>
        </div>
        <button id="mystery-box-btn">🎁</button>
        <button id="open-mystery-box-btn" class="cta-button">Open</button>
    </div>
</div>


<!-- Page 4: Home Page -->
<div id="home-page" class="page">
    <header class="home-header"><h1 class="title">रक्षा सूत्र</h1></header>
    <div class="content-area">
        <div class="cards-container">
            <div class="home-card-wrapper">
                <div id="message-card-btn" class="home-card" style="background-image: url('IMG-20250807-WA0000.jpg');"></div>
                <button id="open-message-creator-btn" class="cta-button">संदेश भेजें</button>
            </div>
            <div class="home-card-wrapper">
                <div id="card-creator-btn" class="home-card" style="background-image: url('Leonardo_Phoenix_10_A_beautifully_designed_Raksha_Bandhan_Mass_1.jpg');"></div>
                <button id="open-card-creator-btn" class="cta-button">कार्ड बनाएं</button>
            </div>
        </div>
    </div>
    <div class="home-footer">
        <div id="view-message-strip" class="footer-strip">संदेश देखें</div>
        <div id="my-profile-strip" class="footer-strip">मेरी प्रोफाइल</div>
        <div id="change-music-strip" class="footer-strip">संगीत बदलें</div>
        <div id="whatsapp-share-strip" class="footer-strip">
            <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="#FFFFFF"><path d="M0 0h24v24H0V0z" fill="none"></path><path d="M.05 22c.12-.59.25-1.18.41-1.76l.09-.32c.31-1.09.7-2.14 1.18-3.15.53-1.12 1.16-2.19 1.88-3.18.82-1.1 1.74-2.1 2.76-3 .2-.18.4-.36.6-.53l.4-.33c.53-.44 1.1-.82 1.7-1.14.99-.53 2.03-.9 3.1-1.1.33-.07.67-.12 1.01-.16.29-.03.59-.05.88-.05.23 0 .46.01.69.03.37.03.74.08 1.1.15.99.19 1.94.55 2.83 1.06.88.5 1.69 1.14 2.41 1.89s1.25 1.53 1.75 2.41c.45.83.78 1.71 1 2.62.22.91.31 1.85.28 2.79-.03.95-.2 1.89-.51 2.79-.31.9-.76 1.76-1.33 2.55-.57.79-1.25 1.5-2.02 2.11-.78.6-1.63 1.1-2.54 1.49-.91.38-1.88.64-2.86.76-.98.12-1.97.1-2.95-.05-.98-.15-1.95-.44-2.88-.86a12.926 12.926 0 01-2.7-1.48c-.24-.13-.47-.27-.7-.41l-1.68-1.02c-.55-.33-1.1-.68-1.64-1.05-.1-.07-.2-.14-.3-.21l-.06-.05c-.62-.48-1.2-1-1.73-1.57-.49-.52-.93-1.08-1.32-1.68-.3-.46-.55-.95-.77-1.45l-.02-.06c-.25-.56-.47-1.14-.65-1.73l-.04-.13c-.22-.72-.39-1.46-.5-2.22-.05-.33-.08-.67-.1-1H.05zM9.3 8.35c.14-.38.33-.74.58-1.06.25-.32.55-.6.88-.82.34-.22.7-.4 1.08-.52s.78-.18 1.18-.18c.39 0 .78.04 1.15.13.37.09.73.23 1.06.41.33.18.64.41.91.68.27.27.5.58.68.91.18.33.31.69.4 1.06.09.37.13.76.13 1.15s-.04.78-.13 1.15c-.09.37-.22.73-.4 1.06-.18.33-.41.64-.68.91-.27.27-.58.5-.91.68-.33.18-.69.32-1.06.41-.37.09-.76.13-1.15.13s-.78-.04-1.15-.13c-.37-.09-.73-.23-1.06-.41-.33-.18-.64-.41-.91-.68-.27.27-.5-.58-.68-.91-.18-.33-.31-.69-.4-1.06-.09-.37-.13-.76-.13-1.15s.05-.78.14-1.15z"></path></svg>
            <span>व्हाट्सएप पर शेयर करें</span>
        </div>
    </div>
</div>

<!-- Page 5: My Profile Page -->
<div id="profile-page" class="page">
    <div class="form-container">
        <h2>मेरी प्रोफाइल</h2>
        <div class="profile-info">
            <p>आपका नाम: <input type="text" id="profile-name-input" class="input-field" placeholder="आपका नाम" required=""></p>
            <p>आपका पता: <textarea id="profile-address-input" class="input-field" placeholder="आपका पता" rows="3" required=""></textarea></p>
            <p>आपकी आईडी: <span id="profile-call-id">रजिस्टर्ड नहीं है</span></p>
        </div>
        <button id="update-profile-btn" class="cta-button">प्रोफाइल अपडेट करें</button>
        <a href="#" class="back-link" data-target="home-page">वापस जाएं</a>
    </div>
</div>


<!-- Page 6: Music Change Page -->
<div id="music-page" class="page">
     <div class="form-container">
        <h2>संगीत बदलें</h2>
        <button class="cta-button music-btn" data-src="1.m4a">रक्षा सूत्र संगीत 1</button>
        <button class="cta-button music-btn" data-src="2.m4a">रक्षा सूत्र संगीत 2</button>
        <button class="cta-button music-btn" data-src="3.m4a">रक्षा सूत्र संगीत 3</button>
        <a href="#" class="back-link" data-target="home-page">वापस जाएं</a>
    </div>
</div>

<!-- Page 7: Pre-made Message Creator Page -->
<div id="message-creator-page" class="page">
    <div class="form-container">
        <h2 id="message-creator-title">किसके लिए संदेश बनाना है?</h2>
        <button id="bhai-to-bhen-btn" class="cta-button" style="width:100%; margin-bottom: 15px;">भाई की तरफ से बहन के लिए</button>
        <button id="bhen-to-bhai-btn" class="cta-button" style="width:100%;">बहन की तरफ से भाई के लिए</button>
         <a href="#" class="back-link" data-target="home-page">वापस जाएं</a>
    </div>
</div>

<!-- Page 8: Name Input for Messages -->
<div id="message-name-form-page" class="page">
    <div class="form-container">
        <h2 id="message-name-title">नाम दर्ज करें</h2>
        <form id="message-name-form">
            <div class="input-group"><input type="text" id="sender-name" class="input-field" placeholder="आपका नाम" required=""></div>
            <div class="input-group"><input type="text" id="receiver-name" class="input-field" placeholder="भाई/बहन का नाम" required=""></div>
            <button type="submit" class="cta-button">संदेश देखें</button>
        </form>
        <a href="#" class="back-link" data-target="message-creator-page">वापस जाएं</a>
    </div>
</div>

<!-- Page 9: Swipeable Message Display Page -->
<div id="message-display-page" class="page">
    <div class="card-viewer-header">
        <button class="header-btn" id="message-display-back-btn">वापस</button>
        <button class="header-btn" id="message-display-share-btn">शेयर</button>
    </div>
    <div class="card-viewer-container" id="message-viewer-container">
        <div id="message-display-card"></div>
    </div>
    <p id="swipe-indicator">अगला संदेश देखने के लिए स्वाइप करें</p>
</div>


<!-- Page 10: Card Message Input Page -->
<div id="card-message-input-page" class="page">
    <div class="form-container">
        <h2>अपना संदेश लिखें</h2>
        <div class="input-group">
            <textarea id="card-wish-input" class="input-field" placeholder="यहां अपनी शुभकामना लिखें..." required="" rows="8"></textarea>
        </div>
        <button id="go-to-custom-card-btn" class="cta-button">कार्ड देखें</button>
        <a href="#" class="back-link" data-target="home-page">वापस जाएं</a>
    </div>
</div>

<!-- Page 11: Custom Card Display Page -->
<div id="custom-card-display-page" class="page">
    <div class="card-viewer-header">
        <button class="header-btn" id="custom-card-back-btn">वापस</button>
        <button class="header-btn" id="custom-card-share-btn">शेयर</button>
    </div>
    <div class="card-viewer-container" id="custom-card-viewer-container">
        <div id="custom-card-display-content"></div>
    </div>
</div>

<!-- Page 12: View Shared Message Page -->
<div id="view-shared-message-page" class="page">
    <div class="card-viewer-header" style="justify-content: flex-start;">
        <button class="header-btn" id="view-shared-message-back-btn">वापस</button>
    </div>
    <div class="card-viewer-container" id="view-shared-message-container">
        <div id="view-shared-message-content"></div>
    </div>
</div>


<!-- Firebase SDKs -->
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
    import { getFirestore, doc, setDoc, getDoc, updateDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";
    
    const firebaseConfig = {
        apiKey: "AIzaSyB2PG5JvDko2UmQDlY9gN5lBgga2vQy-Ws",
        authDomain: "conceptra-c1000.firebaseapp.com",
        databaseURL: "https://conceptra-c1000-default-rtdb.firebaseio.com",
        projectId: "conceptra-c1000",
        storageBucket: "conceptra-c1000.firebasestorage.app",
        messagingSenderId: "298402987968",
        appId: "1:298402987968:web:c0d0d7d6c08cdfa6bc5225",
        measurementId: "G-QRQYEVSJJ6"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const audio = document.getElementById('background-audio');
    audio.src = '3.m4a';
    audio.loop = true;
    audio.volume = 0.4;
    const speakerIcon = document.getElementById('speaker-icon');
    let isMusicPlaying = false;
    let fallingElementsInterval;
    
    let messageType = ''; 
    let currentMessageIndex = 0;

    const cardBackgroundImages = [
        'IMG-20250807-WA0001.jpg',
        'IMG-20250807-WA0002.jpg',
        'IMG-20250807-WA0003.jpg',
        'IMG-20250807-WA0004.jpg'
    ];
    
    const bhenToBhaiMessages = [
        "प्रिय [भाई का नाम],\nरक्षा बंधन का यह पावन दिन हमारे रिश्ते की सबसे बड़ी पहचान है। यह सिर्फ एक धागा नहीं, बल्कि प्यार, भरोसा और दुआओं का बंधन है। जब मैं तुम्हारी कलाई पर राखी बाँधती हूँ, तो मेरे दिल में सिर्फ यही दुआ होती है कि तुम्हारी जिंदगी में हमेशा खुशियाँ बनी रहें, और हर मुश्किल तुमसे कोसों दूर हो। हमने साथ में जो पल बिताए हैं, वे मेरी जिंदगी के सबसे खूबसूरत पल हैं — कभी मस्ती, कभी तकरार, कभी हँसी, कभी आँसू, लेकिन हमेशा एक-दूसरे के साथ खड़े रहना। तुम सिर्फ मेरे भाई नहीं, बल्कि मेरे सबसे बड़े सहारे हो। आज के दिन मैं वादा करती हूँ कि जैसे तुमने हमेशा मेरी रक्षा की है, वैसे ही मैं भी हमेशा तुम्हारी खुशी और सफलता की दुआ करती रहूँगी। चाहे दूरी कितनी भी हो, मेरा आशीर्वाद हमेशा तुम्हारे साथ है। राखी मुबारक हो, [भाई का नाम]।",
        "प्रिय [भाई का नाम],\nरक्षा बंधन का दिन आते ही बचपन की ढेरों यादें ताज़ा हो जाती हैं — सुबह-सुबह तैयार होना, थाली सजाना, मिठाई लाना और तुम्हें राखी बाँधना। यह धागा सिर्फ एक रिवाज़ नहीं, बल्कि हमारे रिश्ते की ताकत है। तुम हमेशा मेरे लिए प्रेरणा रहे हो। तुम्हारी मुस्कान मेरे लिए हौसले की वजह है, और तुम्हारी सफलता मेरे लिए गर्व की बात। आज के दिन मैं बस यही कहना चाहती हूँ कि चाहे हम कितने भी दूर हों, यह बंधन हमेशा हमें जोड़े रखेगा। ईश्वर से प्रार्थना है कि तुम्हारे जीवन में सुख, शांति और समृद्धि बनी रहे, और हर दिन तुम्हारे लिए नई खुशियाँ लेकर आए। रक्षा बंधन की ढेर सारी शुभकामनाएँ, [भाई का नाम]।",
        "प्रिय [भाई का नाम],\nयह राखी मेरे विश्वास और आशीर्वाद का प्रतीक है। इसे बाँधते हुए मैं भगवान से प्रार्थना करती हूँ कि तुम्हारी राह हमेशा आसान हो, और तुम्हारे सपने पूरे हों। हमारा रिश्ता सिर्फ भाई-बहन का नहीं, बल्कि एक गहरी दोस्ती का भी है। हमने साथ में हँसी भी बाँटी है और दुख भी, और यही हमारी ताकत है। आज मैं वादा करती हूँ कि जैसे तुमने हर परिस्थिति में मेरा साथ दिया है, वैसे ही मैं भी हमेशा तुम्हारे लिए खड़ी रहूँगी। तुम्हारे जीवन में कभी कोई कमी न आए और तुम हमेशा खुश रहो — यही मेरी सबसे बड़ी दुआ है। राखी की ढेर सारी शुभकामनाएँ।",
        "प्रिय [भाई का नाम],\nरक्षा बंधन का यह पर्व मुझे हमेशा याद दिलाता है कि जिंदगी में रिश्ते ही सबसे बड़ी पूँजी होते हैं। तुम्हारा साथ पाकर मैं खुद को भाग्यशाली मानती हूँ। तुम सिर्फ मेरे भाई नहीं, बल्कि मेरी ताकत हो। तुम्हारी हिम्मत और स्नेह ने मुझे हमेशा प्रेरित किया है। आज मैं बस यही कहना चाहती हूँ कि चाहे दुनिया कितनी भी बदल जाए, हमारा यह रिश्ता कभी नहीं बदलेगा। ईश्वर तुम्हें लंबी उम्र, स्वास्थ्य और असीम खुशियाँ दें। रक्षा बंधन की हार्दिक शुभकामनाएँ।",
        "प्रिय [भाई का नाम],\nआज जब मैं तुम्हारी कलाई पर राखी बाँधने की सोचती हूँ, তো मेरे मन में गर्व और खुशी दोनों उमड़ आते हैं। यह धागा हमें सिर्फ एक दिन के लिए नहीं, बल्कि पूरी जिंदगी के लिए जोड़ता है। हमारी यादों का खज़ाना बहुत बड़ा है — बचपन की नोकझोंक, साथ बिताए त्योहार, और एक-दूसरे के लिए किए गए छोटे-बड़े त्याग। तुम्हारी सफलता मेरी खुशी है, और तुम्हारी मुस्कान मेरी सबसे बड़ी पूँजी। मैं भगवान से यही दुआ करती हूँ कि तुम्हारा हर दिन पिछले दिन से ज्यादा खुशियों भरा हो। राखी मुबारक हो, [भाई का नाम]।",
        "प्रिय [भाई का नाम],\nरक्षा बंधन का यह पावन अवसर हर साल हमें याद दिलाता है कि जीवन में कुछ रिश्ते ऐसे होते हैं जिन्हें शब्दों में नहीं बाँधा जा सकता। हमारा रिश्ता भी उन्हीं में से एक है। जब मैं तुम्हारी कलाई पर राखी बाँधती हूँ, तो यह सिर्फ एक रिवाज़ नहीं होता, बल्कि यह मेरे विश्वास, प्यार और दुआओं का प्रतीक होता है। तुम्हारी मौजूदगी मेरे जीवन में सुरक्षा और संबल का एहसास कराती है। चाहे मैं खुशियों में हूँ या मुश्किल में, तुम्हारा सहारा मेरे साथ है — यह सोचकर ही मन को सुकून मिलता है। भगवान से मेरी यही प्रार्थना है कि तुम्हारा जीवन हमेशा सुख-समृद्धि और खुशियों से भरा रहे। रक्षा बंधन की हार्दिक शुभकामनाएँ।",
        "प्रिय [भाई का नाम],\nराखी का यह त्योहार हमें बचपन की हँसी-खुशी, छोटी-छोटी नोकझोंक और ढेर सारी प्यारी यादों की ओर ले जाता है। तुम मेरे लिए सिर्फ एक रिश्तेदार नहीं, बल्कि एक ऐसे दोस्त हो जो हर परिस्थिति में मेरे साथ खड़ा रहा है। जब भी मैं राखी बाँधती हूँ, मेरे मन में यह भावना जागती है कि यह धागा हमारे अटूट रिश्ते की डोर है, जो समय और दूरी से परे है। ईश्वर तुम्हारी हर मनोकामना पूरी करे और तुम्हें जीवन के हर क्षेत्र में सफलता प्रदान करे। राखी की शुभकामनाएँ।",
        "प्रिय [भाई का नाम],\nरक्षा बंधन का दिन हमेशा मेरे लिए खास रहा है, क्योंकि यह सिर्फ एक त्योहार नहीं बल्कि हमारे रिश्ते का उत्सव है। तुम्हारे साथ बिताए गए लम्हे, तुम्हारा साथ और तुम्हारी मुस्कान — ये सब मेरी जिंदगी के अनमोल तोहफ़े हैं। आज के दिन मैं भगवान से यही दुआ करती हूँ कि तुम्हारा जीवन खुशियों से भरा हो और तुम्हारी हर राह आसान बने। यह राखी तुम्हारे लिए मेरी प्रार्थना और आशीर्वाद का प्रतीक है। राखी मुबारक हो, [भाई का नाम]।",
        "प्रिय [भाई का नाम],\nराखी का धागा छोटा जरूर है, लेकिन इसमें जुड़ी भावनाएँ और दुआएँ बेहद बड़ी होती हैं। तुमने हमेशा मुझे एक सुरक्षित और प्यार भरा एहसास दिया है। चाहे मैं कितनी भी दूर रहूँ, तुम्हारी याद और तुम्हारा सहारा हमेशा मेरे साथ रहता है। आज मैं तुम्हारे लिए यही कामना करती हूँ कि तुम्हारी जिंदगी में कभी कोई दुख न आए और तुम्हारी मुस्कान हमेशा बनी रहे। राखी की ढेर सारी शुभकामनाएँ।",
        "प्रिय [भाई का नाम],\nजब मैं तुम्हें राखी बाँधती हूँ, तो यह सिर्फ एक रस्म नहीं, बल्कि मेरे दिल की गहराइयों से निकली दुआ होती है। तुम मेरे लिए सिर्फ भाई नहीं, बल्कि एक प्रेरणा हो। तुम्हारे साथ बिताए गए हर लम्हे ने मुझे यह सिखाया है कि रिश्ते की असली ताकत भरोसे और साथ में है। भगवान तुम्हें हर खुशी दे और तुम्हारा जीवन हमेशा उज्ज्वल रहे। रक्षा बंधन की हार्दिक बधाई।",
        "प्रिय [भाई का नाम],\nराखी का यह पावन दिन हमें हमारे रिश्ते की मजबूती का एहसास कराता है। चाहे कितनी भी दूरी आ जाए, यह धागा हमें हमेशा जोड़कर रखता है। तुम्हारी सफलता और खुशी मेरी सबसे बड़ी चाहत है। मैं प्रार्थना करती हूँ कि तुम्हारा हर कदम सफलता की ओर बढ़े और तुम्हारे जीवन में खुशियों की कभी कमी न हो। राखी मुबारक हो।",
        "प्रिय [भाई का नाम],\nराखी का यह त्योहार मुझे हमेशा गर्व का एहसास कराता है कि मेरे जीवन में तुम्हारा साथ है। तुम्हारी देखभाल, प्यार और मार्गदर्शन ने मुझे हमेशा सही रास्ता दिखाया है। यह राखी मेरे विश्वास, दुआ और स्नेह की डोर है, जो कभी टूट नहीं सकती। तुम्हारा जीवन खुशियों और शांति से भरा रहे — यही मेरी सबसे बड़ी इच्छा है। राखी की शुभकामनाएँ।",
        "प्रिय [भाई का नाम],\nराखी का धागा जितना साधारण दिखता है, उतना ही गहरा इसका अर्थ है। यह हमारी यादों, भावनाओं और दुआओं को एक साथ बाँधता है। तुम्हारा साथ मेरे लिए सबसे बड़ी ताकत है। आज मैं वादा करती हूँ कि मैं हमेशा तुम्हारी खुशी के लिए प्रार्थना करती रहूँगी। रक्षा बंधन की बधाई।",
        "प्रिय [भाई का नाम],\nराखी का दिन आते ही मेरा दिल खुशियों से भर जाता है। यह सिर्फ एक धागा नहीं, बल्कि हमारे रिश्ते की अटूट डोर है। तुम्हारे साथ बिताए हुए हर पल मेरे लिए अमूल्य है। ईश्वर तुम्हें लंबी उम्र, सफलता और असीम खुशियाँ दें। राखी मुबारक हो।",
        "प्रिय [भाई का नाम],\nआज के दिन मैं तुम्हें यह एहसास दिलाना चाहती हूँ कि चाहे जीवन में कुछ भी हो, यह रिश्ता हमेशा रहेगा। राखी की यह डोर हमें हमेशा जोड़े रखेगी। तुम्हारी हर खुशी मेरी खुशी है और तुम्हारी हर सफलता मेरा गर्व। रक्षा बंधन की हार्दिक शुभकामनाएँ।",
        "प्रिय [भाई का नाम],\nराखी का यह धागा तुम्हारे लिए मेरी दुआओं और शुभकामनाओं का प्रतीक है। तुम हमेशा स्वस्थ, खुश और सफल रहो — यही मेरी प्रार्थना है। चाहे कितनी भी दूरी आ जाए, यह रिश्ता अटूट रहेगा। राखी की बधाई।",
        "प्रिय [भाई का नाम],\nआज के दिन मैं तुम्हें यह वादा देती हूँ कि तुम्हारी खुशी और सफलता के लिए हमेशा दुआ करूँगी। राखी हमारे रिश्ते की ताकत है, और यह हमेशा हमें जोड़े रखेगी। रक्षा बंधन की शुभकामनाएँ।",
        "प्रिय [भाई का नाम],\nराखी का यह त्योहार हमें याद दिलाता है कि रिश्ते की असली ताकत प्यार और भरोसे में है। तुम्हारा साथ मेरे लिए सबसे बड़ी नेमत है। तुम्हें राखी की ढेर सारी शुभकामनाएँ और दुआएँ।",
        "प्रिय [भाई का नाम],\nआज राखी के इस शुभ दिन पर मैं तुम्हारे लिए सिर्फ यही चाहती हूँ कि तुम्हारा जीवन खुशियों से भरपूर हो। तुम्हारे हर सपने पूरे हों और तुम्हारी राह हमेशा आसान बने। रक्षा बंधन मुबारक हो।",
        "प्रिय [भाई का नाम],\nराखी का यह छोटा सा धागा हमारे प्यार, भरोसे और दुआओं की सबसे बड़ी पहचान है। तुम्हारा जीवन हमेशा उजाले से भरा रहे और तुम्हारे चेहरे पर मुस्कान बनी रहे। राखी की हार्दिक शुभकामनाएँ।"
    ];

    const bhaiToBhenMessages = [
        "प्रिय बहना,\nरक्षा बंधन का यह दिन मेरे लिए हमेशा खास रहा है, क्योंकि इस दिन मुझे यह एहसास होता है कि मैं कितना भाग्यशाली हूँ जो मुझे तुम्हारे जैसी बहन मिली है। बचपन से लेकर आज तक, तुम्हारा साथ, तुम्हारी मुस्कान और तुम्हारी देखभाल ने मेरी जिंदगी को खूबसूरत बनाया है। जब भी मैं परेशान हुआ, तुम्हारे शब्दों ने मुझे हिम्मत दी, और जब भी खुश हुआ, तुम्हारी खुशी ने मेरी खुशी को दोगुना कर दिया। आज इस राखी के दिन मैं वादा करता हूँ कि चाहे समय कितना भी बदल जाए, मैं हमेशा तुम्हारा सहारा, तुम्हारा दोस्त और तुम्हारा भाई बनकर रहूँगा। भगवान से मेरी यही दुआ है कि तुम्हारी जिंदगी खुशियों से भरपूर रहे, तुम्हारे सारे सपने पूरे हों और तुम्हें कभी कोई दुख छू भी न सके। राखी की ढेर सारी शुभकामनाएँ, प्यारी बहना।",
        "मेरी प्यारी बहन,\nराखी का यह त्योहार केवल तुम्हारे लिए नहीं, बल्कि मेरे लिए भी उतना ही खास है। तुम्हारे हाथों से बंधी राखी मेरे लिए सिर्फ एक धागा नहीं, बल्कि तुम्हारे विश्वास, प्यार और दुआओं का प्रतीक है। मुझे आज भी याद है वो बचपन के दिन, जब हम साथ खेलते, लड़ते और फिर बिना बोले एक-दूसरे को माफ कर देते थे। तुम हमेशा मेरी ताकत रही हो, और तुम्हारी मासूम हँसी मेरे जीवन का सबसे बड़ा खजाना है। मैं चाहता हूँ कि तुम्हारी जिंदगी हमेशा खुशियों से रोशन रहे और तुम्हारे चेहरे की मुस्कान कभी फीकी न पड़े। तुम्हारा भाई हमेशा तुम्हारे साथ है। रक्षा बंधन की शुभकामनाएँ।",
        "प्यारी बहना,\nरक्षा बंधन का यह दिन हमारे रिश्ते का सबसे सुंदर उत्सव है। तुम्हारी राखी मेरी कलाई पर बंधते ही मुझे यह एहसास होता है कि यह डोर हमें जीवनभर जोड़े रखेगी। तुम्हारी सुरक्षा और खुशी मेरी सबसे बड़ी जिम्मेदारी है, और मैं हमेशा इस जिम्मेदारी को निभाता रहूँगा। तुम सिर्फ मेरी बहन नहीं, बल्कि मेरी सबसे अच्छी दोस्त भी हो, जो मुझे समझती है और बिना कहे मेरा हाल जान लेती है। ईश्वर से मेरी यही प्रार्थना है कि तुम्हें हर वह खुशी मिले जिसकी तुम हकदार हो। राखी की हार्दिक शुभकामनाएँ।",
        "प्रिय बहना,\nराखी का यह दिन आते ही बचपन की ढेरों यादें ताजा हो जाती हैं — वो मस्ती, वो नोकझोंक, और त्योहारों की वो मीठी खुशबू। तुम्हारी राखी मेरे लिए सबसे अनमोल तोहफ़ा है, क्योंकि इसमें तुम्हारा प्यार और आशीर्वाद दोनों बंधा होता है। मैं हमेशा तुम्हारे लिए ढाल बनकर खड़ा रहूँगा, चाहे परिस्थितियाँ कैसी भी हों। तुम्हारी खुशी और सुरक्षा मेरी सबसे बड़ी प्राथमिकता है। रक्षा बंधन की ढेर सारी शुभकामनाएँ, मेरी प्यारी बहन।",
        "प्यारी बहन,\nतुम मेरी जिंदगी का सबसे सुंदर हिस्सा हो। राखी का दिन मुझे यह याद दिलाता है कि तुम्हारे बिना मेरी जिंदगी अधूरी है। तुम्हारे विश्वास और प्यार ने मुझे हमेशा बेहतर इंसान बनने की प्रेरणा दी है। आज के दिन मैं यह वादा करता हूँ कि मैं हमेशा तुम्हारे साथ खड़ा रहूँगा, तुम्हारी हर खुशी में शामिल रहूँगा और तुम्हारे हर दुख को कम करने की कोशिश करूँगा। तुम्हारा भाई हमेशा तुम्हारे लिए दुआ करता है। रक्षा बंधन की शुभकामनाएँ।",
        "मेरी प्यारी बहन,\nरक्षा बंधन का यह पावन दिन मुझे तुम्हारे महत्व का एहसास दिलाता है। तुम्हारे हाथों से बंधी राखी सिर्फ एक धागा नहीं, बल्कि हमारी आत्मा का बंधन है। तुम्हारे साथ बिताए गए बचपन के पल, तुम्हारी हँसी, तुम्हारा गुस्सा और तुम्हारी देखभाल — ये सब मेरी जिंदगी के अनमोल खजाने हैं। मैं वादा करता हूँ कि जब तक मैं ज़िंदा हूँ, तुम्हें कभी किसी चीज़ की कमी महसूस नहीं होने दूँगा। ईश्वर से मेरी प्रार्थना है कि तुम्हारे जीवन में हमेशा उजाला रहे और तुम्हारी मुस्कान कभी फीकी न पड़े। राखी की ढेर सारी शुभकामनाएँ।",
        "प्यारी बहना,\nराखी के इस पावन अवसर पर मैं दिल से धन्यवाद कहना चाहता हूँ कि तुमने हमेशा मुझे प्यार और दुआओं से नवाजा। तुम्हारी राखी मेरे लिए प्रेरणा है कि मैं हमेशा तुम्हारी रक्षा करूँ और तुम्हें हर दुख से बचाऊँ। हमारा रिश्ता सिर्फ भाई-बहन का नहीं, बल्कि दोस्ती, भरोसे और आपसी सम्मान का भी है। तुम्हारे चेहरे की मुस्कान मेरी सबसे बड़ी जीत है, और तुम्हारा दुख मेरी सबसे बड़ी हार। मैं हमेशा तुम्हारे साथ हूँ। रक्षा बंधन की शुभकामनाएँ।",
        "प्रिय बहना,\nजब तुम मेरी कलाई पर राखी बाँधती हो, तो ऐसा लगता है जैसे तुमने मेरे जीवन में एक नया आशीर्वाद भर दिया हो। यह त्योहार हमें हर साल याद दिलाता है कि चाहे हम कितनी भी दूर क्यों न हों, दिलों का रिश्ता हमेशा करीब रहेगा। तुम्हारी खुशी और सुरक्षा मेरी सबसे बड़ी जिम्मेदारी है। तुम हमेशा सफल और खुश रहो — यही मेरी सबसे बड़ी दुआ है। राखी की हार्दिक बधाई।",
        "मेरी प्यारी बहन,\nतुम मेरे जीवन की सबसे कीमती दौलत हो। राखी का यह दिन मुझे यह एहसास कराता है कि तुम्हारे बिना मेरा जीवन अधूरा है। तुम्हारी हँसी, तुम्हारी बातें और तुम्हारा साथ मुझे हर मुश्किल से लड़ने की ताकत देता है। मैं हमेशा तुम्हारे साथ खड़ा रहूँगा, चाहे परिस्थितियाँ कैसी भी हों। रक्षा बंधन की शुभकामनाएँ।",
        "प्रिय बहना,\nतुम्हारे साथ बचपन की यादें मेरी जिंदगी की सबसे सुंदर कहानियाँ हैं। राखी का यह त्योहार हमें उन दिनों की याद दिलाता है जब हम बेफिक्र होकर खेलते और हँसते थे। तुम्हारा भाई होने पर मुझे गर्व है। ईश्वर से मेरी प्रार्थना है कि तुम्हारे जीवन में हमेशा खुशियाँ बनी रहें और तुम्हारे सारे सपने पूरे हों। राखी मुबारक हो।",
        "मेरी बहना,\nराखी का यह दिन मुझे तुम्हारी अहमियत याद दिलाता है। तुम्हारा साथ, तुम्हारी हिम्मत और तुम्हारा प्यार मेरे लिए हमेशा प्रेरणा रहा है। मैं वादा करता हूँ कि तुम्हें हमेशा अपनी बहन होने पर गर्व महसूस होगा। तुम्हारे जीवन में कभी कोई दुख न आए और तुम्हारे हर दिन में खुशियाँ हों — यही मेरी दुआ है। रक्षा बंधन की हार्दिक शुभकामनाएँ।",
        "प्यारी बहन,\nतुम मेरी जिंदगी का वो हिस्सा हो जिसे मैं कभी खोना नहीं चाहता। राखी का यह धागा हमारे रिश्ते की मजबूती का प्रतीक है। तुम्हारी खुशी मेरी सबसे बड़ी प्राथमिकता है। मैं हमेशा तुम्हारा सहारा और रक्षक बनकर रहूँगा। राखी की शुभकामनाएँ।",
        "मेरी प्यारी बहना,\nतुम्हारे साथ बिताया हर लम्हा मेरे लिए खास है। राखी के इस दिन मैं वादा करता हूँ कि चाहे दुनिया कितनी भी बदल जाए, मेरा प्यार और साथ हमेशा तुम्हारे साथ रहेगा। तुम्हारे लिए मेरी दुआ है कि तुम्हारी जिंदगी में खुशियों की कभी कमी न हो। रक्षा बंधन मुबारक हो।",
        "प्रिय बहना,\nतुम सिर्फ मेरी बहन नहीं, बल्कि मेरी सबसे अच्छी दोस्त भी हो। राखी का यह दिन मुझे यह याद दिलाता है कि तुम्हारे बिना मेरा जीवन अधूरा है। तुम्हारी सफलता और खुशी मेरा सबसे बड़ा सपना है। राखी की शुभकामनाएँ।",
        "प्यारी बहन,\nजब तुम मेरी कलाई पर राखी बाँधती हो, तो यह सिर्फ एक धागा नहीं, बल्कि तुम्हारे विश्वास और प्यार का तोहफ़ा होता है। मैं हमेशा तुम्हें हर बुराई से बचाने की कोशिश करूँगा। तुम्हारे चेहरे की मुस्कान मेरी सबसे बड़ी ताकत है। रक्षा बंधन की हार्दिक शुभकामनाएँ।",
        "मेरी प्यारी बहन,\nतुम्हारे बिना मेरा जीवन अधूरा है। राखी का यह दिन मुझे तुम्हारी अहमियत और हमारे रिश्ते की मजबूती का एहसास कराता है। मैं हमेशा तुम्हारे साथ खड़ा रहूँगा। तुम्हारी खुशी मेरी खुशी है। राखी की शुभकामनाएँ।",
        "प्रिय बहना,\nतुम मेरी जिंदगी की सबसे अनमोल दौलत हो। राखी का यह धागा हमारे अटूट रिश्ते का प्रतीक है। तुम्हारे जीवन में हमेशा खुशियाँ और सफलता बनी रहे — यही मेरी दुआ है। रक्षा बंधन मुबारक हो।",
        "प्यारी बहना,\nतुम्हारी राखी मेरे लिए सबसे बड़ा आशीर्वाद है। यह मुझे यह याद दिलाती है कि तुम्हारी रक्षा करना मेरा कर्तव्य है। तुम्हारे जीवन में कभी कोई दुख न आए और तुम्हारे सपने पूरे हों। राखी की शुभकामनाएँ।",
        "प्रिय बहना,\nराखी का यह पावन दिन हमारे रिश्ते की ताकत का प्रतीक है। तुम्हारी हँसी और खुशी मेरी सबसे बड़ी प्राथमिकता है। मैं हमेशा तुम्हारे साथ खड़ा रहूँगा। रक्षा बंधन की शुभकामनाएँ।",
        "मेरी प्यारी बहन,\nतुम्हारा भाई होने पर मुझे गर्व है। राखी का यह धागा हमारे प्यार और विश्वास की डोर है। ईश्वर से मेरी प्रार्थना है कि तुम्हारे जीवन में हमेशा खुशियाँ बनी रहें। रक्षा बंधन मुबारक हो।"
    ];
    
    const mainVideoPlayer = document.getElementById('main-video-player');
    mainVideoPlayer.volume = 0.3; // Set video volume lower
    const mainInterfaceVideos = [ 'main interfacemp4.mp4', 'coming soon rakshabandhan __ 9 August 2025 _comingsoon _rakhi_happyrakshabandhan_status_short(360P).mp4' ];
    let currentMainVideoIndex = 0;
    
    let hiVoices = [];

    function loadVoices() {
        hiVoices = speechSynthesis.getVoices().filter(voice => voice.lang === 'hi-IN');
    }

    loadVoices();
    if (speechSynthesis.onvoiceschanged !== undefined) {
        speechSynthesis.onvoiceschanged = loadVoices;
    }

    function speakMessage(text, gender = 'female') {
        if (!window.speechSynthesis || !text) return;
        window.speechSynthesis.cancel();
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = 'hi-IN';
        utterance.rate = 0.9;
        utterance.pitch = 1.0;
        utterance.volume = 1.0;
        
        let selectedVoice = null;
        if (hiVoices.length > 0) {
            // Try to find a voice of the specified gender
            const genderVoices = hiVoices.filter(voice => voice.name.toLowerCase().includes(gender) || (voice.gender && voice.gender.toLowerCase() === gender));
            if(genderVoices.length > 0) {
                selectedVoice = genderVoices[0];
            } else {
                // Fallback to the first available Hindi voice if gender-specific is not found
                selectedVoice = hiVoices[0];
            }
        }
        
        if (selectedVoice) {
            utterance.voice = selectedVoice;
        }
        
        // Use a small timeout to ensure any previous speech is cancelled.
        setTimeout(() => {
            window.speechSynthesis.speak(utterance);
        }, 100);
    }
    
    function generateUniqueId() {
        return Math.random().toString(36).substring(2, 7);
    }
    
    async function shareMessage(messageText) {
        const uniqueId = generateUniqueId();
        try {
            await setDoc(doc(db, "sharedMessages", uniqueId), { message: messageText, createdAt: serverTimestamp() });
            const baseUrl = `${window.location.origin}${window.location.pathname}`;
            const shareUrl = `${baseUrl}?msg=true`;
            const introText = "आपके लिए एक खास रक्षाबंधन संदेश है! 🎁\n\n";
            const instructions = `इसे देखने के लिए लिंक पर क्लिक करें और यह यूनिक कोड डालें: *${uniqueId.toUpperCase()}*\n\n${shareUrl}`;
            const fullMessage = introText + instructions;
            const whatsappUrl = `https://api.whatsapp.com/send?text=${encodeURIComponent(fullMessage)}`;
            window.open(whatsappUrl, '_blank');
        } catch(e) {
            console.error("Error creating share link: ", e);
            alert("शेयर लिंक बनाते समय त्रुटि हुई।");
        }
    }
    
    async function showSharedMessage(messageId) {
        document.getElementById('unique-id-modal').classList.remove('active');
        try {
            const messageDocRef = doc(db, "sharedMessages", messageId);
            const docSnap = await getDoc(messageDocRef);
            if (docSnap.exists()) {
                const messageText = docSnap.data().message;
                document.getElementById('view-shared-message-content').textContent = messageText;
                const bgIndex = Math.floor(Math.random() * cardBackgroundImages.length);
                document.getElementById('view-shared-message-container').style.backgroundImage = `url('${cardBackgroundImages[bgIndex]}')`;
                
                showPage('view-shared-message-page');
                
                // Determine gender from message content for speech
                let gender = 'female'; // Default to female
                if (messageText.includes('प्रिय बहना') || messageText.includes('प्यारी बहन')) {
                    gender = 'male';
                }
                setTimeout(() => speakMessage(messageText, gender), 500);

            } else {
                alert("यह संदेश कोड अमान्य है। कृपया पुनः प्रयास करें।");
                document.getElementById('unique-id-modal').classList.add('active');
            }
        } catch(e) {
             alert("संदेश लोड करते समय त्रुटि हुई।");
             console.error(e);
             document.getElementById('unique-id-modal').classList.add('active');
        }
    }

    async function loadProfileForEditing() {
        const userId = localStorage.getItem('rakshaSutraUserId');
        if (!userId) {
            alert("प्रोफ़ाइल देखने के लिए आपका पंजीकृत होना आवश्यक है।");
            showPage('form-page');
            return;
        }
        document.getElementById('profile-call-id').textContent = userId;
        try {
            const docSnap = await getDoc(doc(db, "users", userId));
            if (docSnap.exists()) {
                const userData = docSnap.data();
                document.getElementById('profile-name-input').value = userData.name || '';
                document.getElementById('profile-address-input').value = userData.address || '';
            } else {
                localStorage.clear();
                showPage('form-page');
            }
        } catch (error) {
            console.error("Error getting document:", error);
            alert("आपकी प्रोफ़ाइल लोड करते समय एक त्रुटि हुई: " + error.message);
        }
    }

    function showPage(pageId) {
        window.speechSynthesis.cancel();
        document.querySelectorAll('.page.active').forEach(p => p.classList.remove('active'));
        const page = document.getElementById(pageId);
        if (page) {
            page.classList.add('active');
        }

        if (pageId === 'main-interface-page') {
            startFallingElements();
            if (!audio.paused) {
                audio.pause();
                localStorage.setItem('musicWasPlaying', 'true');
            } else {
                localStorage.setItem('musicWasPlaying', 'false');
            }
            mainVideoPlayer.muted = false;
            mainVideoPlayer.play().catch(e => {});
        } else {
             if (fallingElementsInterval) {
                clearInterval(fallingElementsInterval);
                const container = document.getElementById('falling-elements-container');
                if (container) container.innerHTML = '';
             }
             if (localStorage.getItem('musicWasPlaying') === 'true' && audio.paused) {
                audio.play().catch(()=>{});
             }
        }
        
        if (pageId === 'profile-page') {
            loadProfileForEditing();
        }
    }

    function toggleMusic() {
        if (audio.paused) {
            audio.play().then(() => {
                speakerIcon.textContent = '🔊';
                isMusicPlaying = true;
                localStorage.setItem('musicWasPlaying', 'true');
            }).catch(() => { isMusicPlaying = false; });
        } else {
            audio.pause();
            speakerIcon.textContent = '🔇';
            isMusicPlaying = false;
            localStorage.setItem('musicWasPlaying', 'false');
        }
    }
    
    function startFallingElements() {
        if (fallingElementsInterval) clearInterval(fallingElementsInterval);
        const container = document.getElementById('falling-elements-container');
        if (!container) return;
        container.innerHTML = '';
        const elements = ['🌺', '🌹', '🌸', '🌷', '🌼', '🏵️', '💮'];
        fallingElementsInterval = setInterval(() => {
            const element = document.createElement('div');
            element.className = 'falling-element';
            element.textContent = elements[Math.floor(Math.random() * elements.length)];
            element.style.left = Math.random() * 100 + 'vw';
            element.style.animationDuration = Math.random() * 5 + 5 + 's';
            element.style.fontSize = Math.random() * 1.5 + 1 + 'rem';
            container.appendChild(element);
            setTimeout(() => { element.remove(); }, 10000);
        }, 300);
    }

    function setupMainInterfacePage(userName) {
        const messageText = `प्रिय ${userName},\n\nरक्षाबंधन का यह पावन अवसर प्रेम, विश्वास और सुरक्षा के उस बंधन का प्रतीक है जो हमें जीवनभर जोड़े रखता है।\nहमारे Shubhzone.shop परिवार का हिस्सा बनने के लिए आपका धन्यवाद। आपका विश्वास हमारे लिए वैसा ही है जैसे एक बहन के लिए अपने भाई का वचन— हमेशा साथ निभाने का।\n\nइस त्योहार पर हमारी यही शुभकामना है कि आपके जीवन में हमेशा खुशियां, सफलता और रिश्तों की गर्माहट बनी रहे।\n\nरक्षाबंधन की हार्दिक शुभकामनाएं!\nसप्रेम,\nShubhzone.shop परिवार`;
        
        document.getElementById('main-interface-message').textContent = messageText;
        mainVideoPlayer.src = mainInterfaceVideos[currentMainVideoIndex];
        showPage('main-interface-page');
        setTimeout(() => speakMessage(messageText, 'female'), 2500);
    }
    
    function playNextMainVideo() {
        currentMainVideoIndex = (currentMainVideoIndex + 1) % mainInterfaceVideos.length;
        mainVideoPlayer.src = mainInterfaceVideos[currentMainVideoIndex];
        mainVideoPlayer.play();
    }
    
    function displayCurrentMessage() {
        const sender = document.getElementById('sender-name').value;
        const receiver = document.getElementById('receiver-name').value;
        const messages = messageType === 'bhai-to-bhen' ? bhaiToBhenMessages : bhenToBhaiMessages;
        let messageTemplate = messages[currentMessageIndex];
        let formattedMessage = messageTemplate.replace(/\[भाई का नाम\]/g, receiver).replace(/\[नाम\]/g, receiver).replace(/प्रिय बहना/g, `प्रिय बहना ${receiver}`);
        const cardElement = document.getElementById('message-display-card');
        const containerElement = document.getElementById('message-viewer-container');
        cardElement.classList.remove('card-animation');
        void cardElement.offsetWidth;
        cardElement.classList.add('card-animation');
        const fullText = formattedMessage + `\n\nस्नेह सहित,\n${sender}`;
        cardElement.textContent = fullText;
        const bgIndex = currentMessageIndex % cardBackgroundImages.length;
        containerElement.style.backgroundImage = `url('${cardBackgroundImages[bgIndex]}')`;
        const gender = messageType === 'bhai-to-bhen' ? 'male' : 'female';
        speakMessage(fullText, gender);
    }

    // --- Event Listeners ---
    window.addEventListener('load', () => {
        // **FIX:** The modal will no longer open automatically on page load.
        // It always starts with the landing page.
        showPage('landing-page');
    });

    document.getElementById('unique-id-form').addEventListener('submit', (e) => {
        e.preventDefault();
        const enteredId = document.getElementById('unique-id-input').value.toLowerCase().trim();
        if (enteredId.length === 5) {
             showSharedMessage(enteredId);
        } else {
            alert("कृपया 5-अंकीय कोड डालें।");
        }
    });

    document.getElementById('close-unique-id-modal-btn').addEventListener('click', () => {
        document.getElementById('unique-id-modal').classList.remove('active');
    });

    document.getElementById('view-shared-message-back-btn').addEventListener('click', () => {
        showPage('home-page');
    });

    speakerIcon.addEventListener('click', toggleMusic);

    document.getElementById('get-started-btn').addEventListener('click', () => {
        audio.play().then(() => audio.pause()).catch(() => {});
        // **FIX:** This logic ensures new users must register.
        if (localStorage.getItem('rakshaSutraUserId')) {
            setupMainInterfacePage(localStorage.getItem('rakshaSutraUserName'));
        } else {
            showPage('form-page');
        }
    });
    
    document.getElementById('open-mystery-box-btn').addEventListener('click', () => showPage('home-page'));

    document.getElementById('info-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        const submitButton = e.target.querySelector('button[type="submit"]');
        submitButton.disabled = true;
        submitButton.textContent = 'सबमिट हो रहा है...';
        const phone = document.getElementById('phone').value;
        const name = document.getElementById('name').value;
        const address = document.getElementById('address').value;
        try {
            await setDoc(doc(db, "users", phone), { name, phone, address, timestamp: serverTimestamp() });
            localStorage.setItem('rakshaSutraUserName', name);
            localStorage.setItem('rakshaSutraUserId', phone);
            alert(`धन्यवाद, ${name}! आपकी प्रोफ़ाइल बन गई है।\nआपकी आईडी है: ${phone}`);
            setupMainInterfacePage(name);
        } catch (error) {
            alert("एक त्रुटि हुई: " + error.message);
        } finally {
            submitButton.disabled = false;
            submitButton.textContent = 'सबमिट करें';
        }
    });

    mainVideoPlayer.addEventListener('ended', playNextMainVideo);
    
    document.getElementById('update-profile-btn').addEventListener('click', async () => {
        const userId = localStorage.getItem('rakshaSutraUserId');
        if (!userId) { alert("उपयोगकर्ता पंजीकृत नहीं है।"); return; }
        const newName = document.getElementById('profile-name-input').value;
        const newAddress = document.getElementById('profile-address-input').value;
        if (!newName || !newAddress) { alert("नाम और पता खाली नहीं हो सकता।"); return; }
        const updateButton = document.getElementById('update-profile-btn');
        updateButton.disabled = true;
        updateButton.textContent = 'अपडेट हो रहा है...';
        try {
            await updateDoc(doc(db, "users", userId), { name: newName, address: newAddress });
            localStorage.setItem('rakshaSutraUserName', newName);
            alert("प्रोफ़ाइल सफलतापूर्वक अपडेट की गई!");
        } catch (error) {
            alert("अपडेट करते समय एक त्रुटि हुई: " + error.message);
        } finally {
            updateButton.disabled = false;
            updateButton.textContent = 'प्रोफाइल अपडेट करें';
        }
    });
    
    // Home Page Buttons
    document.getElementById('open-message-creator-btn').addEventListener('click', () => showPage('message-creator-page'));
    document.getElementById('message-card-btn').addEventListener('click', () => showPage('message-creator-page'));
    document.getElementById('open-card-creator-btn').addEventListener('click', () => showPage('card-message-input-page'));
    document.getElementById('card-creator-btn').addEventListener('click', () => showPage('card-message-input-page'));
    document.getElementById('change-music-strip').addEventListener('click', () => showPage('music-page'));
    document.getElementById('my-profile-strip').addEventListener('click', () => showPage('profile-page'));
    document.getElementById('view-message-strip').addEventListener('click', () => document.getElementById('unique-id-modal').classList.add('active'));

    document.getElementById('whatsapp-share-strip').addEventListener('click', () => {
        const message = encodeURIComponent(`इस रक्षाबंधन, अपने भाई-बहन को एक विशेष डिजिटल राखी भेजें! इस खूबसूरत वेबसाइट को देखें: ${window.location.origin}`);
        window.open(`https://api.whatsapp.com/send?text=${message}`, '_blank');
    });

    document.querySelectorAll('.back-link').forEach(link => {
        link.addEventListener('click', (e) => {
            e.preventDefault();
            showPage(link.dataset.target);
        });
    });
    
    document.querySelectorAll('.music-btn').forEach(button => {
        button.addEventListener('click', () => {
            audio.src = button.dataset.src;
            if (!isMusicPlaying) {
                toggleMusic();
            } else {
                audio.play();
            }
            showPage('home-page');
        });
    });
    
    document.getElementById('bhai-to-bhen-btn').addEventListener('click', () => {
        messageType = 'bhai-to-bhen';
        showPage('message-name-form-page');
    });

    document.getElementById('bhen-to-bhai-btn').addEventListener('click', () => {
        messageType = 'bhen-to-bhai';
        showPage('message-name-form-page');
    });
    
    document.getElementById('message-name-form').addEventListener('submit', (e) => {
        e.preventDefault();
        currentMessageIndex = 0;
        showPage('message-display-page');
        setTimeout(displayCurrentMessage, 100);
    });
    
    let messageTouchStartX = 0;
    document.getElementById('message-viewer-container').addEventListener('touchstart', e => { messageTouchStartX = e.changedTouches[0].screenX; }, { passive: true });
    document.getElementById('message-viewer-container').addEventListener('touchend', e => {
        const touchendX = e.changedTouches[0].screenX;
        const totalMessages = (messageType === 'bhai-to-bhen' ? bhaiToBhenMessages : bhenToBhaiMessages).length;
        if (touchendX < messageTouchStartX - 50) { 
            currentMessageIndex = (currentMessageIndex + 1) % totalMessages;
        } else if (touchendX > messageTouchStartX + 50) {
            currentMessageIndex = (currentMessageIndex - 1 + totalMessages) % totalMessages;
        } else { return; }
        displayCurrentMessage();
    });

    document.getElementById('message-display-share-btn').addEventListener('click', () => {
        const messageToShare = document.getElementById('message-display-card').textContent;
        shareMessage(messageToShare);
    });
    document.getElementById('message-display-back-btn').addEventListener('click', () => showPage('message-name-form-page'));

    // --- Custom Card Creator Flow ---
    document.getElementById('go-to-custom-card-btn').addEventListener('click', () => {
        const wishText = document.getElementById('card-wish-input').value;
        if (!wishText.trim()) {
            alert("कृपया अपनी शुभकामना लिखें।");
            return;
        }
        document.getElementById('custom-card-display-content').textContent = wishText;
        const bgIndex = Math.floor(Math.random() * cardBackgroundImages.length);
        document.getElementById('custom-card-viewer-container').style.backgroundImage = `url('${cardBackgroundImages[bgIndex]}')`;
        showPage('custom-card-display-page');
    });

    document.getElementById('custom-card-share-btn').addEventListener('click', () => {
        const messageToShare = document.getElementById('custom-card-display-content').textContent;
        shareMessage(messageToShare);
    });
    document.getElementById('custom-card-back-btn').addEventListener('click', () => showPage('card-message-input-page'));

</script>
</body>
</html>
